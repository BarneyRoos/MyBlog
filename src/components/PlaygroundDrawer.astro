---
import CodeEditor from './CodeEditor';

declare global {
  interface Window {
    openPlaygroundDrawer: () => void;
    closePlaygroundDrawer: () => void;
  }
}
---

<div id="playgroundDrawer" class="fixed right-0 top-0 w-full h-full flex z-100 transition-all duration-300" style="opacity: 0; visibility: hidden;">
  <div class="drawer-overlay absolute left-0 top-0 w-full h-full bg-black/50 cursor-pointer"></div>
  <div class="drawer-content relative ml-auto w-3/5 h-full bg-white flex flex-col shadow-lg transform transition-transform duration-300" style="transform: translateX(100%);">
    <div class="flex justify-between items-center px-5 py-4 border-b border-gray-200 bg-gray-100">
      <h2 class="text-base font-semibold text-gray-800">代码练兵场</h2>
      <button class="drawer-close bg-none border-none text-2xl text-gray-500 cursor-pointer p-0 w-8 h-8 flex items-center justify-center transition-colors hover:text-gray-800" id="drawerClose">&times;</button>
    </div>
    
    <div class="flex-1 overflow-hidden">
      <CodeEditor client:only="react" storagePrefix="drawer_" />
    </div>
  </div>
</div>

<script>
  declare global {
    interface Window {
      openPlaygroundDrawer: () => void;
      closePlaygroundDrawer: () => void;
    }
  }

  window.openPlaygroundDrawer = function() {
    const drawer = document.getElementById('playgroundDrawer');
    if (!drawer) return;
    
    drawer.classList.add('open');
    document.body.style.overflow = 'hidden';
  };

  window.closePlaygroundDrawer = function() {
    const drawer = document.getElementById('playgroundDrawer');
    if (!drawer) return;
    
    drawer.classList.remove('open');
    document.body.style.overflow = 'auto';
  };

  document.addEventListener('DOMContentLoaded', () => {
    const drawer = document.getElementById('playgroundDrawer');
    const drawerClose = document.getElementById('drawerClose');
    const drawerOverlay = drawer?.querySelector('.drawer-overlay');

    if (drawerClose) {
      drawerClose.addEventListener('click', window.closePlaygroundDrawer);
    }
    if (drawerOverlay) {
      drawerOverlay.addEventListener('click', window.closePlaygroundDrawer);
    }
  });

  document.addEventListener('keydown', (e) => {
    const drawer = document.getElementById('playgroundDrawer');
    if (e.key === 'Escape' && drawer?.classList.contains('open')) {
      window.closePlaygroundDrawer();
    }
  });
</script>
<style>
  #playgroundDrawer.open {
    opacity: 1 !important;
    visibility: visible !important;
  }

  #playgroundDrawer.open .drawer-content {
    transform: translateX(0) !important;
  }

  @media (max-width: 1200px) {
    .drawer-content {
      width: 75%;
    }
  }

  @media (max-width: 768px) {
    .drawer-content {
      width: 100%;
    }

    .grid {
      grid-template-columns: 1fr;
    }
  }
</style>
