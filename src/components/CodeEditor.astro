---
interface Props {
  containerId?: string;
  htmlPaneId?: string;
  cssPaneId?: string;
  jsPaneId?: string;
  previewFrameId?: string;
  consoleOutputId?: string;
  themeId?: string;
  clearBtnId?: string;
  downloadBtnId?: string;
  refreshBtnId?: string;
  consoleClearBtnId?: string;
  storagePrefix?: string;
}

const {
  containerId = 'editor-container',
  htmlPaneId = 'htmlPane',
  cssPaneId = 'cssPane',
  jsPaneId = 'jsPane',
  previewFrameId = 'previewFrame',
  consoleOutputId = 'consoleOutput',
  themeId = 'themeSelector',
  clearBtnId = 'clearBtn',
  downloadBtnId = 'downloadBtn',
  refreshBtnId = 'refreshBtn',
  consoleClearBtnId = 'consoleClearBtn',
  storagePrefix = '',
} = Astro.props;
---

<div class="flex flex-col bg-white rounded-lg shadow overflow-hidden h-full">
  <div class="flex border-b-2 border-gray-200 bg-gray-50">
    <button class="tab-btn active flex-1 px-4 py-3 border-none bg-transparent cursor-pointer text-sm font-medium text-gray-500 border-b-2 border-transparent transition-all hover:bg-gray-200 hover:text-slate-800" data-tab="html">HTML</button>
    <button class="tab-btn flex-1 px-4 py-3 border-none bg-transparent cursor-pointer text-sm font-medium text-gray-500 border-b-2 border-transparent transition-all hover:bg-gray-200 hover:text-slate-800" data-tab="css">CSS</button>
    <button class="tab-btn flex-1 px-4 py-3 border-none bg-transparent cursor-pointer text-sm font-medium text-gray-500 border-b-2 border-transparent transition-all hover:bg-gray-200 hover:text-slate-800" data-tab="js">JavaScript</button>
  </div>

  <div class="flex-1 relative overflow-hidden">
    <div class={`editor-pane active absolute inset-0`} data-tab="html" id={htmlPaneId}></div>
    <div class={`editor-pane absolute inset-0`} data-tab="css" id={cssPaneId}></div>
    <div class={`editor-pane absolute inset-0`} data-tab="js" id={jsPaneId}></div>
  </div>

  <div class="flex gap-2.5 px-4 py-3 border-t border-gray-200 bg-gray-50 items-center">
    <select id={themeId} class="px-2.5 py-1.5 border border-gray-400 rounded bg-white text-slate-800 cursor-pointer text-xs transition-all hover:border-blue-500">
      <option value="vs">Light</option>
      <option value="vs-dark" selected>Dark</option>
      <option value="hc-black">High Contrast</option>
    </select>
    <button id={clearBtnId} class="px-3.5 py-2 border border-gray-400 bg-white rounded cursor-pointer text-sm transition-all hover:bg-red-500 hover:text-white hover:border-red-500">清空所有</button>
    <button id={downloadBtnId} class="px-3.5 py-2 border border-gray-400 bg-white rounded cursor-pointer text-sm transition-all hover:bg-green-600 hover:text-white hover:border-green-600">下载代码</button>
    <span class="ml-auto text-xs text-gray-400">自动保存中...</span>
  </div>
</div>

<div class="flex flex-col bg-white rounded-lg shadow overflow-hidden h-full">
  <div class="flex justify-between items-center px-4 py-1 border-b border-gray-200 bg-gray-50">
    <h3 class="m-0 text-slate-800 text-sm font-medium">预览</h3>
    <button id={refreshBtnId} class="px-3 py-1.5 border border-gray-400 bg-white rounded cursor-pointer text-base transition-all hover:bg-blue-500 hover:text-white hover:border-blue-500" title="刷新预览">⟳</button>
  </div>
  <iframe id={previewFrameId} class="flex-1 border-none bg-white" sandbox="allow-scripts"></iframe>
  <div class="flex flex-col h-48 border-t border-gray-200 bg-gray-50">
    <div class="flex justify-between items-center px-3 py-2 border-b border-gray-200 bg-gray-100">
      <h3 class="m-0 text-gray-800 text-xs font-semibold uppercase">控制台</h3>
      <button id={consoleClearBtnId} class="px-2 py-1 border border-gray-300 bg-white rounded text-xs cursor-pointer transition-all hover:bg-gray-100 hover:border-gray-400" title="清空控制台">清空</button>
    </div>
    <div id={consoleOutputId} class="flex-1 overflow-y-auto px-3 py-2 font-mono text-sm leading-relaxed bg-[#2c3e50]" style="letter-spacing: 0.3px;"></div>
  </div>
</div>

<style>
  .editor-pane {
    /* transition: opacity 0.3s ease-in-out; */
  }

  .editor-pane.active {
    opacity: 1 !important;
    visibility: visible !important;
  }

  .editor-pane:not(.active) {
    opacity: 0 !important;
    visibility: hidden !important;
  }

  .tab-btn {
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease-in-out;
  }

  .tab-btn.active {
    border-bottom-color: #3b82f6;
    color: #3b82f6;
    font-weight: 600;
  }

  /* Console日志颜色样式 */
  .console-log {
    color: #f0f0f0 !important;
    margin: 2px 0 !important;
    padding: 0 !important;
    word-break: break-all;
    font-weight: 500 !important;
  }

  .console-log.console-error {
    color: #ff5555 !important;
    font-weight: 600 !important;
  }

  .console-log.console-warn {
    color: #ffb86c !important;
    font-weight: 600 !important;
  }

  .console-log.console-info {
    color: #5dade2 !important;
    font-weight: 500 !important;
  }
</style>
