---
import BaseLayout from '../layouts/BaseLayout.astro';
import CodeEditor from '../components/CodeEditor.astro';
---

<BaseLayout title="‰ª£Á†ÅÁªÉÂÖµÂú∫ - ÂÆûÊó∂ÁºñËæëÂíåÈ¢ÑËßà">

  <div class="min-h-screen bg-[#fffcf8] p-5">
    <div class="max-w-7xl mx-auto mb-8 text-center">
      <h1 
        class="text-4xl font-bold text-slate-800 mb-3"
      >
        üíª
        <span
          style="display: inline-block; background: linear-gradient(90deg, #ec4899 0%, #8b5cf6 50%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
        >
        ‰ª£Á†ÅÁªÉÂÖµÂú∫
        </span>
      </h1>
      <p class="text-lg text-slate-600">‰ΩøÁî® Monaco Editor ÂÆûÊó∂ÁºñÂÜôÂíåÈ¢ÑËßà HTML„ÄÅCSS„ÄÅJavaScript ‰ª£Á†Å</p>
    </div>

    <div class="grid grid-cols-2 gap-1 max-w-7xl mx-auto relative z-10" style="height: calc(100vh - 200px);">
      <CodeEditor
        htmlPaneId="htmlPane"
        cssPaneId="cssPane"
        jsPaneId="jsPane"
        previewFrameId="previewFrame"
        consoleOutputId="consoleOutput"
        themeId="themeSelector"
        clearBtnId="clearBtn"
        downloadBtnId="downloadBtn"
        refreshBtnId="refreshBtn"
        consoleClearBtnId="consoleClearBtn"
        storagePrefix="playground_"
      />
    </div>
  </div>
</BaseLayout>

<script>
  import { createEditors, setupEditorListeners, generatePreviewHTML } from '../lib/editorUtils';

  const config = {
    htmlPaneId: 'htmlPane',
    cssPaneId: 'cssPane',
    jsPaneId: 'jsPane',
    previewFrameId: 'previewFrame',
    consoleOutputId: 'consoleOutput',
    themeId: 'themeSelector',
    clearBtnId: 'clearBtn',
    downloadBtnId: 'downloadBtn',
    refreshBtnId: 'refreshBtn',
    consoleClearBtnId: 'consoleClearBtn',
    storagePrefix: 'playground_',
  };

  const editors = createEditors(config);
  const previewFrame = document.getElementById('previewFrame') as HTMLIFrameElement;
  const consoleOutput = document.getElementById('consoleOutput') as HTMLElement;

  function updatePreview() {
    const html = editors.htmlEditor.getValue();
    const css = editors.cssEditor.getValue();
    const js = editors.jsEditor.getValue();

    const iframeContent = generatePreviewHTML(html, css, js);
    previewFrame.srcdoc = iframeContent;

    localStorage.setItem('playground_htmlCode', html);
    localStorage.setItem('playground_cssCode', css);
    localStorage.setItem('playground_jsCode', js);

    if (consoleOutput) {
      consoleOutput.innerHTML = '';
    }
  }

  setupEditorListeners(config, editors, updatePreview);
  updatePreview();
</script>
