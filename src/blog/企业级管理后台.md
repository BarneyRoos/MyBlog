---
title: "ä¼ä¸šçº§ç®¡ç†åå°"
pubDate: 2026-01-28T08:00:00.000Z
description: "åŸºäºNext.js & Nest.jsï¼Œå®Œæ•´çš„ä¼ä¸šçº§ç®¡ç†åå°è®¾è®¡æ–¹æ¡ˆã€æ¶æ„è§„åˆ’ã€åŠŸèƒ½æ¸…å•ã€æ•°æ®æ¨¡å‹è®¾è®¡å’Œå®ç°æŒ‡å—ã€‚æ¶µç›–æƒé™ç®¡ç†ã€å®¡è®¡æ—¥å¿—ã€æ•°æ®å­—å…¸ã€æ–‡ä»¶ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½"
author: "æµ·å·"
image:
  url: ""
  alt: ""
tags: ["Next.js", "Nest.js", "åå°ç®¡ç†", "æ¶æ„è®¾è®¡"]
---

## å‰è¨€

ä¼ä¸šçº§ç®¡ç†åå°æ˜¯ B ç«¯åº”ç”¨çš„æ ¸å¿ƒã€‚ä½†ä»é›¶å¼€å§‹æ„å»ºæ—¶ï¼Œå¾ˆå¤šå¼€å‘è€…ä¸æ¸…æ¥š**åº”è¯¥åŒ…å«å“ªäº›é€šç”¨åŠŸèƒ½**ã€**å¦‚ä½•ç»„ç»‡ä»£ç ç»“æ„**ã€**æ€æ ·è®¾è®¡æƒé™ç³»ç»Ÿ**ã€‚

æœ¬æ–‡ä»**åŠŸèƒ½è®¾è®¡**å‡ºå‘ï¼Œè®²è§£ä¼ä¸šçº§ç®¡ç†åå°çš„**é€šç”¨ç»„ä»¶**å’Œ**æ¶æ„æ¨¡å¼**ï¼Œæœ€åç»™å‡º**åˆ†å±‚å®ç°æ–¹æ¡ˆ**ã€‚æ— è®ºä½ æ˜¯åˆåˆ›å…¬å¸è¿˜æ˜¯å¤§å‹ä¼ä¸šï¼Œéƒ½èƒ½ä»ä¸­è·å¾—å‚è€ƒã€‚

---

## ä¸€ã€ä¼ä¸šçº§ç®¡ç†åå°çš„æ ¸å¿ƒç‰¹å¾

### ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸šçº§ç®¡ç†åå°ï¼Ÿ

```
ä¸ªäººåº”ç”¨          ä¼ä¸šåº”ç”¨
â””â”€ å•ç”¨æˆ·        â””â”€ å¤šç”¨æˆ·
â””â”€ ç®€å•åŠŸèƒ½      â””â”€ å¤æ‚æƒé™
â””â”€ æ— å®¡è®¡        â””â”€ éœ€è¦å®¡è®¡
â””â”€ é™æ€ç•Œé¢      â””â”€ åŠ¨æ€é…ç½®
â””â”€ å•ä¸€éƒ¨ç½²      â””â”€ å¤šå¥—éƒ¨ç½²
```

**ä¼ä¸šçº§ç®¡ç†åå°çš„äº”å¤§éœ€æ±‚**ï¼š

| éœ€æ±‚         | ä¸ºä»€ä¹ˆ                     | è§£å†³æ–¹æ¡ˆ           |
| ------------ | -------------------------- | ------------------ |
| **æƒé™æ§åˆ¶** | ä¸åŒè§’è‰²çœ‹ä¸åŒåŠŸèƒ½         | RBAC/ABACæƒé™æ¨¡å‹  |
| **å®¡è®¡è¿½è¸ª** | è®°å½•æ‰€æœ‰ç”¨æˆ·æ“ä½œï¼Œé˜²æ­¢çº çº· | æ“ä½œæ—¥å¿—ã€å˜æ›´æ—¥å¿— |
| **æ•°æ®ç®¡ç†** | æ”¯æŒæµ·é‡æ•°æ®å’Œå¤æ‚æŸ¥è¯¢     | åˆ†é¡µã€æœç´¢ã€å¯¼å‡º   |
| **ç³»ç»Ÿé…ç½®** | çµæ´»æ”¯æŒä¸šåŠ¡å˜åŒ–           | æ•°æ®å­—å…¸ã€ç³»ç»Ÿå‚æ•° |
| **æ‰©å±•æ€§**   | æ”¯æŒä¸šåŠ¡å¿«é€Ÿè¿­ä»£           | æ¨¡å—åŒ–ã€æ’ä»¶åŒ–æ¶æ„ |

---

## äºŒã€æ¶æ„è®¾è®¡

### æ•´ä½“ç³»ç»Ÿæ¶æ„

![æ¶æ„å›¾](/blog/ä¼ä¸šçº§ç®¡ç†åå°/æ¶æ„å›¾.png)

### åˆ†å±‚è®¾è®¡ï¼ˆåç«¯ï¼‰

```
Request
  â†“
Controller (è·¯ç”±ã€å…¥å‚éªŒè¯)
  â†“
Service (ä¸šåŠ¡é€»è¾‘)
  â†“
Repository (æ•°æ®è®¿é—®)
  â†“
Database
  â†“
Response
```

**å„å±‚èŒè´£**ï¼š

- **Controller** - æ¥æ”¶è¯·æ±‚ã€å‚æ•°éªŒè¯ã€è¿”å›å“åº”
- **Service** - ä¸šåŠ¡é€»è¾‘ã€æƒé™æ ¡éªŒã€äº‹åŠ¡ç®¡ç†
- **Repository** - æ•°æ®åº“æ“ä½œã€æŸ¥è¯¢ä¼˜åŒ–
- **Database** - æ•°æ®å­˜å‚¨

---

## ä¸‰ã€é€šç”¨åŠŸèƒ½æ¨¡å—æ¸…å•

### 1. ç”¨æˆ·å’Œè®¤è¯ç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ç”¨æˆ·æ³¨å†Œ/ç™»å½•/ç™»å‡º
- å¯†ç ä¿®æ”¹/é‡ç½®
- å¤šè®¾å¤‡ç™»å½•
- ç™»å½•æ—¥å¿—
- ä¼šè¯ç®¡ç†

**æ•°æ®æ¨¡å‹**ï¼š

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  real_name VARCHAR(100),
  avatar_url VARCHAR(255),
  status ENUM('active', 'inactive', 'locked'), -- çŠ¶æ€
  last_login_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ç™»å½•æ—¥å¿—
CREATE TABLE login_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  login_time TIMESTAMP DEFAULT NOW(),
  login_ip VARCHAR(50),
  login_device VARCHAR(100),
  login_status ENUM('success', 'failed'),
  remark VARCHAR(255)
);
```

---

### 2. è§’è‰²å’Œæƒé™ç®¡ç†ï¼ˆRBACï¼‰

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **User** - ç”¨æˆ·
- **Role** - è§’è‰²ï¼ˆå¦‚ç®¡ç†å‘˜ã€ç»ç†ã€å‘˜å·¥ï¼‰
- **Permission** - æƒé™ï¼ˆå¦‚æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
- **Menu** - èœå•ï¼ˆåŠ¨æ€èœå•ï¼‰

**æƒé™æ¨¡å‹**ï¼š

```
User â† has many â†’ Role â† has many â†’ Permission
                   â†“
                  Menu
```

**æ•°æ®æ¨¡å‹**ï¼š

```sql
-- è§’è‰²è¡¨
CREATE TABLE roles (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) UNIQUE NOT NULL, -- å¦‚ 'admin', 'manager'
  description VARCHAR(255),
  status ENUM('active', 'inactive'),
  created_at TIMESTAMP DEFAULT NOW()
);

-- ç”¨æˆ·è§’è‰²å…³è”
CREATE TABLE user_roles (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  role_id INTEGER REFERENCES roles(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, role_id)
);

-- æƒé™è¡¨
CREATE TABLE permissions (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) UNIQUE NOT NULL, -- å¦‚ 'user:create', 'user:delete'
  description VARCHAR(255),
  resource VARCHAR(50), -- èµ„æºï¼Œå¦‚ 'user', 'post'
  action VARCHAR(50), -- æ“ä½œï¼Œå¦‚ 'create', 'read', 'update', 'delete'
  created_at TIMESTAMP DEFAULT NOW()
);

-- è§’è‰²æƒé™å…³è”
CREATE TABLE role_permissions (
  id SERIAL PRIMARY KEY,
  role_id INTEGER REFERENCES roles(id) ON DELETE CASCADE,
  permission_id INTEGER REFERENCES permissions(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(role_id, permission_id)
);

-- èœå•è¡¨ï¼ˆå‰ç«¯è·¯ç”±å’Œèœå•ï¼‰
CREATE TABLE menus (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL, -- æ˜¾ç¤ºåç§°ï¼Œå¦‚ 'ç”¨æˆ·ç®¡ç†'
  route VARCHAR(255), -- è·¯ç”±è·¯å¾„ï¼Œå¦‚ '/users'
  icon VARCHAR(100), -- å›¾æ ‡
  parent_id INTEGER REFERENCES menus(id), -- çˆ¶èœå• ID
  order_num INTEGER DEFAULT 0, -- æ’åº
  visible BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

-- èœå•æƒé™å…³è”ï¼ˆæŸä¸ªèœå•éœ€è¦ä»€ä¹ˆæƒé™ï¼‰
CREATE TABLE menu_permissions (
  id SERIAL PRIMARY KEY,
  menu_id INTEGER REFERENCES menus(id) ON DELETE CASCADE,
  permission_id INTEGER REFERENCES permissions(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(menu_id, permission_id)
);
```

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// Nest.js æƒé™è£…é¥°å™¨
import { SetMetadata } from "@nestjs/common";

export const Permissions = (...perms: string[]) =>
  SetMetadata("permissions", perms);

// ä½¿ç”¨
@Controller("users")
export class UsersController {
  @Post()
  @Permissions("user:create")
  createUser(dto: CreateUserDto) {
    // ...
  }

  @Delete(":id")
  @Permissions("user:delete")
  deleteUser(@Param("id") id: number) {
    // ...
  }
}
```

---

### 3. éƒ¨é—¨ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- éƒ¨é—¨æ ‘å½¢ç»“æ„
- éƒ¨é—¨ç¼–è¾‘
- éƒ¨é—¨æˆå‘˜ç®¡ç†

**æ•°æ®æ¨¡å‹**ï¼š

```sql
CREATE TABLE departments (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  parent_id INTEGER REFERENCES departments(id), -- ä¸Šçº§éƒ¨é—¨
  leader_id INTEGER REFERENCES users(id), -- éƒ¨é—¨è´Ÿè´£äºº
  code VARCHAR(50) UNIQUE, -- éƒ¨é—¨ç¼–ç 
  sort_order INTEGER DEFAULT 0,
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ç”¨æˆ·æ‰€å±éƒ¨é—¨ï¼ˆå¤šå¯¹å¤šå…³ç³»ï¼‰
CREATE TABLE user_departments (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  department_id INTEGER REFERENCES departments(id) ON DELETE CASCADE,
  is_main BOOLEAN DEFAULT false, -- æ˜¯å¦ä¸»éƒ¨é—¨
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, department_id)
);
```

---

### 4. æ“ä½œæ—¥å¿—å’Œå®¡è®¡è¿½è¸ª

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- è®°å½•æ‰€æœ‰å¢åˆ æ”¹æ“ä½œ
- è®°å½•æ“ä½œäººã€æ“ä½œæ—¶é—´ã€æ“ä½œå†…å®¹
- æ”¯æŒå˜æ›´å¯¹æ¯”

**æ•°æ®æ¨¡å‹**ï¼š

```sql
-- æ“ä½œæ—¥å¿—
CREATE TABLE operation_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  module_name VARCHAR(100), -- æ¨¡å—åç§°ï¼Œå¦‚ 'user_management'
  operation VARCHAR(50), -- æ“ä½œç±»å‹ï¼šCREATE, UPDATE, DELETE
  resource_type VARCHAR(100), -- èµ„æºç±»å‹ï¼Œå¦‚ 'User'
  resource_id INTEGER, -- èµ„æº ID
  description VARCHAR(255),
  operation_time TIMESTAMP DEFAULT NOW(),
  operation_ip VARCHAR(50),
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- å˜æ›´æ—¥å¿—ï¼ˆè®°å½•å­—æ®µçº§åˆ«çš„å˜åŒ–ï¼‰
CREATE TABLE change_logs (
  id SERIAL PRIMARY KEY,
  operation_log_id INTEGER REFERENCES operation_logs(id) ON DELETE CASCADE,
  field_name VARCHAR(100), -- å­—æ®µå
  old_value TEXT, -- æ—§å€¼
  new_value TEXT, -- æ–°å€¼
  change_type VARCHAR(50), -- ADDED, MODIFIED, DELETED
  created_at TIMESTAMP DEFAULT NOW()
);
```

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// åˆ›å»ºè£…é¥°å™¨æ¥è‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—
@Controller("users")
export class UsersController {
  @Post()
  @LogOperation("user_management", "CREATE", "User")
  createUser(dto: CreateUserDto) {
    // æ“ä½œä¼šè‡ªåŠ¨è¢«è®°å½•
  }

  @Patch(":id")
  @LogOperation("user_management", "UPDATE", "User")
  updateUser(@Param("id") id: number, dto: UpdateUserDto) {
    // ...
  }
}
```

---

### 5. æ•°æ®å­—å…¸ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ç®¡ç†ç³»ç»Ÿä¸­çš„æšä¸¾å€¼
- æ”¯æŒå¤šè¯­è¨€
- ç¼“å­˜ä¼˜åŒ–

**ä½¿ç”¨åœºæ™¯**ï¼š

```
æ€§åˆ«ï¼šç”·ã€å¥³ã€å…¶ä»–
çŠ¶æ€ï¼šå¯ç”¨ã€ç¦ç”¨ã€å®¡æ ¸ä¸­
ä¼˜å…ˆçº§ï¼šé«˜ã€ä¸­ã€ä½
```

**æ•°æ®æ¨¡å‹**ï¼š

```sql
-- å­—å…¸ç±»å‹
CREATE TABLE dict_types (
  id SERIAL PRIMARY KEY,
  type_code VARCHAR(50) UNIQUE NOT NULL, -- ç±»å‹ç¼–ç ï¼Œå¦‚ 'gender'
  type_name VARCHAR(100) NOT NULL, -- ç±»å‹åç§°
  description VARCHAR(255),
  status ENUM('active', 'inactive') DEFAULT 'active',
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW()
);

-- å­—å…¸æ•°æ®
CREATE TABLE dict_data (
  id SERIAL PRIMARY KEY,
  dict_type_id INTEGER REFERENCES dict_types(id) ON DELETE CASCADE,
  label VARCHAR(100) NOT NULL, -- æ˜¾ç¤ºå€¼ï¼Œå¦‚ 'ç”·'
  value VARCHAR(100) NOT NULL, -- å®é™…å€¼ï¼Œå¦‚ 'M'
  sort_order INTEGER DEFAULT 0,
  is_default BOOLEAN DEFAULT false,
  status ENUM('active', 'inactive') DEFAULT 'active',
  remark VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(dict_type_id, value)
);
```

**å‰ç«¯ä½¿ç”¨**ï¼š

```typescript
// å®šä¹‰å­—å…¸ç±»å‹
export enum DictType {
  Gender = 'gender',
  Status = 'status',
  Priority = 'priority',
}

// åœ¨è¡¨å•ä¸­ä½¿ç”¨
<Form.Item label="æ€§åˆ«">
  <Select options={dicts[DictType.Gender]} />
</Form.Item>
```

---

### 6. ç³»ç»Ÿå‚æ•°ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ç®¡ç†ç³»ç»Ÿçº§åˆ«çš„é…ç½®
- æ”¯æŒå¤šç§æ•°æ®ç±»å‹
- çƒ­æ›´æ–°

**æ•°æ®æ¨¡å‹**ï¼š

```sql
CREATE TABLE system_configs (
  id SERIAL PRIMARY KEY,
  config_key VARCHAR(100) UNIQUE NOT NULL, -- å‚æ•°é”®ï¼Œå¦‚ 'file_upload_max_size'
  config_value TEXT, -- å‚æ•°å€¼
  config_type VARCHAR(50), -- å‚æ•°ç±»å‹ï¼šstring, number, boolean, json
  description VARCHAR(255),
  remark VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```typescript
// è·å–é…ç½®
const maxFileSize = await configService.get("file_upload_max_size"); // 10485760

// æ›´æ–°é…ç½®
await configService.set("file_upload_max_size", "20971520");
```

---

### 7. æ–‡ä»¶ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- æ–‡ä»¶åˆ—è¡¨ç®¡ç†
- æ–‡ä»¶æœç´¢å’Œè¿‡æ»¤
- åƒåœ¾å›æ”¶

**æ•°æ®æ¨¡å‹**ï¼š

```sql
CREATE TABLE files (
  id SERIAL PRIMARY KEY,
  original_name VARCHAR(255) NOT NULL, -- åŸå§‹æ–‡ä»¶å
  storage_name VARCHAR(255) NOT NULL UNIQUE, -- å­˜å‚¨æ–‡ä»¶å
  file_path VARCHAR(500), -- æ–‡ä»¶è·¯å¾„
  file_size BIGINT, -- æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  file_type VARCHAR(100), -- MIME ç±»å‹
  upload_by INTEGER REFERENCES users(id),
  upload_time TIMESTAMP DEFAULT NOW(),
  related_module VARCHAR(100), -- å…³è”æ¨¡å—ï¼Œå¦‚ 'user_avatar'
  related_id INTEGER, -- å…³è”å¯¹è±¡ ID
  status ENUM('active', 'deleted') DEFAULT 'active',
  deleted_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- æ–‡ä»¶å˜æ›´æ—¥å¿—ï¼ˆè°ä¸Šä¼ çš„ã€ä½•æ—¶åˆ é™¤çš„ï¼‰
CREATE TABLE file_operation_logs (
  id SERIAL PRIMARY KEY,
  file_id INTEGER REFERENCES files(id),
  operation VARCHAR(50), -- UPLOAD, DELETE, DOWNLOAD
  operator_id INTEGER REFERENCES users(id),
  operation_time TIMESTAMP DEFAULT NOW()
);
```

---

### 8. æ¶ˆæ¯å’Œé€šçŸ¥ç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ç³»ç»Ÿæ¶ˆæ¯
- ç”¨æˆ·é€šçŸ¥
- æ¶ˆæ¯æ ‡è®°å·²è¯»

**æ•°æ®æ¨¡å‹**ï¼š

```sql
-- æ¶ˆæ¯æ¨¡æ¿
CREATE TABLE message_templates (
  id SERIAL PRIMARY KEY,
  template_name VARCHAR(100) NOT NULL,
  template_code VARCHAR(100) UNIQUE NOT NULL,
  template_content TEXT, -- æ¨¡æ¿å†…å®¹ï¼Œæ”¯æŒå˜é‡æ›¿æ¢
  template_type VARCHAR(50), -- email, sms, in_app
  created_at TIMESTAMP DEFAULT NOW()
);

-- æ¶ˆæ¯è®°å½•
CREATE TABLE messages (
  id SERIAL PRIMARY KEY,
  recipient_id INTEGER REFERENCES users(id),
  sender_id INTEGER REFERENCES users(id),
  title VARCHAR(255),
  content TEXT,
  message_type VARCHAR(50), -- info, warning, error, success
  is_read BOOLEAN DEFAULT false,
  read_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 9. æ•°æ®å¯¼å…¥å¯¼å‡º

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- æ”¯æŒ CSVã€Excel æ ¼å¼
- æ‰¹é‡å¯¼å…¥
- å¯¼å‡ºå†å²è®°å½•

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// å¯¼å‡ºæ¥å£
@Controller('export')
export class ExportController {
  @Post('users/excel')
  async exportUsersToExcel(
    @Query() filter: FilterUserDto,
    @Res() res: Response,
  ) {
    const users = await this.userService.findAll(filter);
    const buffer = await this.excelService.generateExcel(users);
    res.attachment('users.xlsx');
    res.send(buffer);
  }
}

// å¯¼å…¥æ¥å£
@Post('users/import')
@UseInterceptors(FileInterceptor('file'))
async importUsers(@UploadedFile() file: Express.Multer.File) {
  const data = await this.excelService.parseExcel(file);
  return await this.userService.batchCreate(data);
}
```

---

### 10. ç³»ç»Ÿç›‘æ§å’Œç»Ÿè®¡

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ç”¨æˆ·ç»Ÿè®¡
- æ“ä½œè¶‹åŠ¿
- ç³»ç»Ÿè´Ÿè½½

**æ•°æ®æ¨¡å‹**ï¼š

```sql
-- æ—¥å¸¸ç»Ÿè®¡æ•°æ®
CREATE TABLE daily_statistics (
  id SERIAL PRIMARY KEY,
  stat_date DATE NOT NULL,
  new_user_count INTEGER DEFAULT 0,
  active_user_count INTEGER DEFAULT 0,
  total_operations INTEGER DEFAULT 0,
  peak_concurrency INTEGER DEFAULT 0, -- å³°å€¼å¹¶å‘æ•°
  avg_response_time FLOAT, -- å¹³å‡å“åº”æ—¶é—´ï¼ˆmsï¼‰
  error_rate FLOAT, -- é”™è¯¯ç‡ï¼ˆ%ï¼‰
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(stat_date)
);
```

---

## å››ã€å‰ç«¯é¡¹ç›®ç»“æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
nextjs-admin/
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/               # Next.js 13+ App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx     # å…¨å±€å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx       # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ dashboard/     # ä»ªè¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ users/         # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ permissions/   # æƒé™ç®¡ç†
â”‚   â”‚   â””â”€â”€ settings/      # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ common/        # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Breadcrumb.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminLayout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthLayout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BlankLayout.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ui/            # UI ç»„ä»¶ï¼ˆä» shadcn/ui å¼•å…¥ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Table.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Dialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Form.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ feature/       # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ UserList.tsx
â”‚   â”‚       â”œâ”€â”€ UserForm.tsx
â”‚   â”‚       â”œâ”€â”€ PermissionTree.tsx
â”‚   â”‚       â””â”€â”€ DashboardChart.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api.ts         # API è¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ auth.ts        # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ permissions.ts # æƒé™æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ utils.ts       # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ constants.ts   # å¸¸é‡å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ usePermission.ts
â”‚   â”‚   â”œâ”€â”€ usePagination.ts
â”‚   â”‚   â””â”€â”€ useDict.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ store/             # çŠ¶æ€ç®¡ç†ï¼ˆZustand æˆ– Reduxï¼‰
â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ permissionStore.ts
â”‚   â”‚   â””â”€â”€ uiStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ globals.css    # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ theme.css      # ä¸»é¢˜å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ permission.ts
â”‚   â”‚   â””â”€â”€ common.ts
â”‚   â”‚
â”‚   â””â”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚       â””â”€â”€ auth.ts        # è®¤è¯ä¸­é—´ä»¶
â”‚
â”œâ”€â”€ .env.local            # ç¯å¢ƒå˜é‡
â”œâ”€â”€ tailwind.config.js    # Tailwind é…ç½®
â”œâ”€â”€ next.config.js        # Next.js é…ç½®
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

### å…³é”®æ–‡ä»¶å®ç°

**1. API å°è£… (lib/api.ts)**ï¼š

```typescript
import axios, { AxiosInstance, AxiosError } from "axios";

class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: process.env.NEXT_PUBLIC_API_URL,
      timeout: 10000,
    });

    // è¯·æ±‚æ‹¦æˆªå™¨ï¼šæ·»åŠ  token
    this.client.interceptors.request.use((config) => {
      const token = localStorage.getItem("token");
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    });

    // å“åº”æ‹¦æˆªå™¨ï¼šå¤„ç†é”™è¯¯
    this.client.interceptors.response.use(
      (response) => response.data,
      (error: AxiosError) => {
        if (error.response?.status === 401) {
          // é‡å®šå‘åˆ°ç™»å½•
          window.location.href = "/login";
        }
        throw error;
      },
    );
  }

  get<T>(url: string, config = {}) {
    return this.client.get<any, T>(url, config);
  }

  post<T>(url: string, data?: any, config = {}) {
    return this.client.post<any, T>(url, data, config);
  }

  put<T>(url: string, data?: any, config = {}) {
    return this.client.put<any, T>(url, data, config);
  }

  delete<T>(url: string, config = {}) {
    return this.client.delete<any, T>(url, config);
  }
}

export const api = new ApiClient();
```

**2. æƒé™æ£€æŸ¥ Hook (hooks/usePermission.ts)**ï¼š

```typescript
import { useAuthStore } from "@/store/authStore";

export const usePermission = () => {
  const { permissions } = useAuthStore();

  const hasPermission = (permission: string): boolean => {
    return permissions.includes(permission);
  };

  const can = (action: string, resource: string): boolean => {
    return hasPermission(`${resource}:${action}`);
  };

  const cannot = (action: string, resource: string): boolean => {
    return !can(action, resource);
  };

  return {
    hasPermission,
    can,
    cannot,
  };
};
```

**3. æƒé™ä¿æŠ¤ç»„ä»¶ (components/ui/CanAccess.tsx)**ï¼š

```typescript
import { ReactNode } from "react";
import { usePermission } from "@/hooks/usePermission";

interface CanAccessProps {
  permission: string;
  children: ReactNode;
  fallback?: ReactNode;
}

export const CanAccess = ({
  permission,
  children,
  fallback = null,
}: CanAccessProps) => {
  const { hasPermission } = usePermission();

  return hasPermission(permission) ? children : fallback;
};
```

**4. ç”¨æˆ·åˆ—è¡¨é¡µé¢ (app/users/page.tsx)**ï¼š

```typescript
'use client';

import { useState, useEffect } from 'react';
import { api } from '@/lib/api';
import { usePermission } from '@/hooks/usePermission';
import { Table, Button, Modal, Form, Input } from 'antd';
import { CanAccess } from '@/components/ui/CanAccess';

export default function UsersPage() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(false);
  const [pagination, setPagination] = useState({ current: 1, pageSize: 10 });
  const { can } = usePermission();

  useEffect(() => {
    fetchUsers();
  }, [pagination]);

  const fetchUsers = async () => {
    setLoading(true);
    try {
      const data = await api.get('/api/users', {
        params: {
          page: pagination.current,
          pageSize: pagination.pageSize,
        },
      });
      setUsers(data.items);
      setPagination((prev) => ({
        ...prev,
        total: data.total,
      }));
    } finally {
      setLoading(false);
    }
  };

  const columns = [
    { title: 'ID', dataIndex: 'id' },
    { title: 'ç”¨æˆ·å', dataIndex: 'username' },
    { title: 'é‚®ç®±', dataIndex: 'email' },
    {
      title: 'æ“ä½œ',
      render: (_, record) => (
        <div>
          <CanAccess permission="user:read">
            <Button type="link">æŸ¥çœ‹</Button>
          </CanAccess>
          <CanAccess permission="user:update">
            <Button type="link">ç¼–è¾‘</Button>
          </CanAccess>
          <CanAccess permission="user:delete">
            <Button type="link" danger>
              åˆ é™¤
            </Button>
          </CanAccess>
        </div>
      ),
    },
  ];

  return (
    <div className="p-6">
      <div className="mb-4 flex justify-between">
        <h1 className="text-2xl font-bold">ç”¨æˆ·ç®¡ç†</h1>
        <CanAccess permission="user:create">
          <Button type="primary">æ–°å¢ç”¨æˆ·</Button>
        </CanAccess>
      </div>

      <Table
        columns={columns}
        dataSource={users}
        loading={loading}
        pagination={pagination}
        onChange={(page) => setPagination(page)}
      />
    </div>
  );
}
```

---

## äº”ã€åç«¯é¡¹ç›®ç»“æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
nestjs-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts            # åº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ config/            # é…ç½®
â”‚   â”‚   â”œâ”€â”€ database.config.ts
â”‚   â”‚   â”œâ”€â”€ auth.config.ts
â”‚   â”‚   â””â”€â”€ app.config.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â”‚   â”‚   â””â”€â”€ decorators/
â”‚   â”‚   â”‚       â”œâ”€â”€ auth.decorator.ts
â”‚   â”‚   â”‚       â””â”€â”€ permissions.decorator.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ users/         # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ dtos/
â”‚   â”‚   â”‚       â”œâ”€â”€ create-user.dto.ts
â”‚   â”‚   â”‚       â””â”€â”€ update-user.dto.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ permissions/   # æƒé™ç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.module.ts
â”‚   â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚   â”‚       â”œâ”€â”€ role.entity.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ permission.entity.ts
â”‚   â”‚   â”‚       â””â”€â”€ menu.entity.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ audit/         # å®¡è®¡æ—¥å¿—æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ audit.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ audit.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ audit-log.interceptor.ts
â”‚   â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚   â”‚       â”œâ”€â”€ operation-log.entity.ts
â”‚   â”‚   â”‚       â””â”€â”€ change-log.entity.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dict/          # æ•°æ®å­—å…¸æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ dict.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ dict.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ dict.module.ts
â”‚   â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚   â”‚       â”œâ”€â”€ dict-type.entity.ts
â”‚   â”‚   â”‚       â””â”€â”€ dict-data.entity.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config/        # ç³»ç»Ÿé…ç½®æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ config.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ config.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ config.module.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ files/         # æ–‡ä»¶ç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ files.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ files.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ files.module.ts
â”‚   â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚   â”‚       â””â”€â”€ file.entity.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ dashboard/     # ä»ªè¡¨æ¿æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ dashboard.controller.ts
â”‚   â”‚       â”œâ”€â”€ dashboard.service.ts
â”‚   â”‚       â””â”€â”€ dashboard.module.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ common/            # é€šç”¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ decorators/    # è£…é¥°å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ api-response.decorator.ts
â”‚   â”‚   â”‚   â””â”€â”€ validate.decorator.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ filters/       # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ http-exception.filter.ts
â”‚   â”‚   â”‚   â””â”€â”€ all-exceptions.filter.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ guards/        # å®ˆå«ï¼ˆæƒé™æ£€æŸ¥ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.guard.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ permission.guard.ts
â”‚   â”‚   â”‚   â””â”€â”€ roles.guard.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ interceptors/  # æ‹¦æˆªå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ response.interceptor.ts
â”‚   â”‚   â”‚   â””â”€â”€ logging.interceptor.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pipes/         # ç®¡é“ï¼ˆæ•°æ®å˜æ¢å’ŒéªŒè¯ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ validation.pipe.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ strategies/    # è®¤è¯ç­–ç•¥
â”‚   â”‚   â”‚   â””â”€â”€ jwt.strategy.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ password.util.ts
â”‚   â”‚       â””â”€â”€ pagination.util.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ database/          # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ seeds/         # æ•°æ®åº“ç§å­
â”‚   â”‚       â””â”€â”€ seed.ts
â”‚   â”‚
â”‚   â””â”€â”€ app.module.ts      # åº”ç”¨æ ¹æ¨¡å—
â”‚
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ jest.config.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ .env.local
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### å…³é”®æ–‡ä»¶å®ç°

**1. Prisma Schema (prisma/schema.prisma)**ï¼š

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ç”¨æˆ·è¡¨
model User {
  id                Int       @id @default(autoincrement())
  username          String    @unique
  email             String    @unique
  passwordHash      String
  realName          String?
  avatarUrl         String?
  status            UserStatus @default(ACTIVE)
  lastLoginAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  userRoles         UserRole[]
  loginLogs         LoginLog[]
  operationLogs     OperationLog[]
  files             File[]

  @@map("users")
}

enum UserStatus {
  ACTIVE
  INACTIVE
  LOCKED
}

// è§’è‰²è¡¨
model Role {
  id                Int       @id @default(autoincrement())
  name              String    @unique
  description       String?
  status            RoleStatus @default(ACTIVE)
  createdAt         DateTime  @default(now())

  userRoles         UserRole[]
  rolePermissions   RolePermission[]

  @@map("roles")
}

enum RoleStatus {
  ACTIVE
  INACTIVE
}

// ç”¨æˆ·-è§’è‰²å…³è”
model UserRole {
  id                Int       @id @default(autoincrement())
  userId            Int
  roleId            Int
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  role              Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  createdAt         DateTime  @default(now())

  @@unique([userId, roleId])
  @@map("user_roles")
}

// æƒé™è¡¨
model Permission {
  id                Int       @id @default(autoincrement())
  name              String    @unique
  description       String?
  resource          String
  action            String
  createdAt         DateTime  @default(now())

  rolePermissions   RolePermission[]
  menuPermissions   MenuPermission[]

  @@map("permissions")
}

// è§’è‰²-æƒé™å…³è”
model RolePermission {
  id                Int       @id @default(autoincrement())
  roleId            Int
  permissionId      Int
  role              Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission        Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  createdAt         DateTime  @default(now())

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

// èœå•è¡¨
model Menu {
  id                Int       @id @default(autoincrement())
  name              String
  route             String?
  icon              String?
  parentId          Int?
  parent            Menu?     @relation("ParentMenu", fields: [parentId], references: [id])
  children          Menu[]    @relation("ParentMenu")
  orderNum          Int       @default(0)
  visible           Boolean   @default(true)
  createdAt         DateTime  @default(now())

  menuPermissions   MenuPermission[]

  @@map("menus")
}

// èœå•-æƒé™å…³è”
model MenuPermission {
  id                Int       @id @default(autoincrement())
  menuId            Int
  permissionId      Int
  menu              Menu      @relation(fields: [menuId], references: [id], onDelete: Cascade)
  permission        Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  createdAt         DateTime  @default(now())

  @@unique([menuId, permissionId])
  @@map("menu_permissions")
}

// ç™»å½•æ—¥å¿—
model LoginLog {
  id                Int       @id @default(autoincrement())
  userId            Int
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  loginTime         DateTime  @default(now())
  loginIp           String?
  loginDevice       String?
  loginStatus       LoginStatus
  remark            String?
  createdAt         DateTime  @default(now())

  @@map("login_logs")
}

enum LoginStatus {
  SUCCESS
  FAILED
}

// æ“ä½œæ—¥å¿—
model OperationLog {
  id                Int       @id @default(autoincrement())
  userId            Int
  user              User      @relation(fields: [userId], references: [id], onDelete: SetNull)
  moduleName        String
  operation         Operation
  resourceType      String
  resourceId        Int?
  description       String?
  operationTime     DateTime  @default(now())
  operationIp       String?
  userAgent         String?
  createdAt         DateTime  @default(now())

  changeLogs        ChangeLog[]

  @@map("operation_logs")
}

enum Operation {
  CREATE
  UPDATE
  DELETE
  READ
  EXPORT
}

// å˜æ›´æ—¥å¿—
model ChangeLog {
  id                Int       @id @default(autoincrement())
  operationLogId    Int
  operationLog      OperationLog @relation(fields: [operationLogId], references: [id], onDelete: Cascade)
  fieldName         String
  oldValue          String?
  newValue          String?
  changeType        ChangeType
  createdAt         DateTime  @default(now())

  @@map("change_logs")
}

enum ChangeType {
  ADDED
  MODIFIED
  DELETED
}

// æ–‡ä»¶è¡¨
model File {
  id                Int       @id @default(autoincrement())
  originalName      String
  storageName       String    @unique
  filePath          String
  fileSize          BigInt
  fileType          String
  uploadBy          Int
  user              User      @relation(fields: [uploadBy], references: [id], onDelete: SetNull)
  uploadTime        DateTime  @default(now())
  relatedModule     String?
  relatedId         Int?
  status            FileStatus @default(ACTIVE)
  deletedAt         DateTime?
  createdAt         DateTime  @default(now())

  @@map("files")
}

enum FileStatus {
  ACTIVE
  DELETED
}
```

**2. æƒé™å®ˆå« (common/guards/permission.guard.ts)**ï¼š

```typescript
import {
  Injectable,
  CanActivate,
  ExecutionContext,
  ForbiddenException,
} from "@nestjs/common";
import { Reflector } from "@nestjs/core";
import { JwtService } from "@nestjs/jwt";

@Injectable()
export class PermissionGuard implements CanActivate {
  constructor(
    private reflector: Reflector,
    private jwtService: JwtService,
  ) {}

  async canActivate(context: ExecutionContext): Promise<boolean> {
    const requiredPermissions = this.reflector.get<string[]>(
      "permissions",
      context.getHandler(),
    );

    if (!requiredPermissions) {
      return true; // å¦‚æœæ²¡æœ‰æŒ‡å®šæƒé™è¦æ±‚ï¼Œå…è®¸è®¿é—®
    }

    const request = context.switchToHttp().getRequest();
    const user = request.user;

    if (!user) {
      throw new ForbiddenException("ç”¨æˆ·æœªè®¤è¯");
    }

    const hasPermission = requiredPermissions.some((permission) =>
      user.permissions.includes(permission),
    );

    if (!hasPermission) {
      throw new ForbiddenException("æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤èµ„æº");
    }

    return true;
  }
}
```

**3. å®¡è®¡æ—¥å¿—æ‹¦æˆªå™¨ (modules/audit/interceptors/audit-log.interceptor.ts)**ï¼š

```typescript
import {
  Injectable,
  NestInterceptor,
  ExecutionContext,
  CallHandler,
} from "@nestjs/common";
import { Observable } from "rxjs";
import { tap } from "rxjs/operators";
import { AuditService } from "../audit.service";
import { Reflector } from "@nestjs/core";

@Injectable()
export class AuditLogInterceptor implements NestInterceptor {
  constructor(
    private auditService: AuditService,
    private reflector: Reflector,
  ) {}

  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    const request = context.switchToHttp().getRequest();
    const user = request.user;
    const { method, path, body, query } = request;

    // è·å–è£…é¥°å™¨ä¸­å®šä¹‰çš„å®¡è®¡ä¿¡æ¯
    const auditInfo = this.reflector.get<any>("audit", context.getHandler());

    if (!auditInfo) {
      return next.handle();
    }

    const startTime = Date.now();

    return next.handle().pipe(
      tap((response) => {
        const duration = Date.now() - startTime;

        this.auditService.log({
          userId: user?.id,
          moduleName: auditInfo.module,
          operation: auditInfo.operation,
          resourceType: auditInfo.resource,
          resourceId: body?.id || query?.id,
          description: auditInfo.description,
          operationIp: this.getClientIp(request),
          userAgent: request.headers["user-agent"],
        });
      }),
    );
  }

  private getClientIp(request: any): string {
    return (
      request.headers["x-forwarded-for"]?.split(",")[0] ||
      request.connection.remoteAddress
    );
  }
}
```

**4. ç”¨æˆ·æœåŠ¡ (modules/users/users.service.ts)**ï¼š

```typescript
import { Injectable } from "@nestjs/common";
import { PrismaService } from "@nestjs/prisma";
import { CreateUserDto } from "./dtos/create-user.dto";
import { UpdateUserDto } from "./dtos/update-user.dto";
import * as bcrypt from "bcrypt";

@Injectable()
export class UsersService {
  constructor(private prisma: PrismaService) {}

  async create(dto: CreateUserDto) {
    const passwordHash = await bcrypt.hash(dto.password, 10);

    return this.prisma.user.create({
      data: {
        username: dto.username,
        email: dto.email,
        passwordHash,
        realName: dto.realName,
      },
      include: {
        userRoles: {
          include: {
            role: {
              include: {
                rolePermissions: {
                  include: {
                    permission: true,
                  },
                },
              },
            },
          },
        },
      },
    });
  }

  async findAll(
    page: number = 1,
    pageSize: number = 10,
    filters?: Record<string, any>,
  ) {
    const skip = (page - 1) * pageSize;

    const where = this.buildWhereClause(filters);

    const [items, total] = await Promise.all([
      this.prisma.user.findMany({
        where,
        skip,
        take: pageSize,
        include: {
          userRoles: {
            include: {
              role: true,
            },
          },
        },
      }),
      this.prisma.user.count({ where }),
    ]);

    return {
      items,
      total,
      page,
      pageSize,
      totalPages: Math.ceil(total / pageSize),
    };
  }

  async findById(id: number) {
    return this.prisma.user.findUniqueOrThrow({
      where: { id },
      include: {
        userRoles: {
          include: {
            role: {
              include: {
                rolePermissions: {
                  include: {
                    permission: true,
                  },
                },
              },
            },
          },
        },
      },
    });
  }

  async update(id: number, dto: UpdateUserDto) {
    return this.prisma.user.update({
      where: { id },
      data: dto,
      include: {
        userRoles: {
          include: {
            role: true,
          },
        },
      },
    });
  }

  async delete(id: number) {
    return this.prisma.user.delete({
      where: { id },
    });
  }

  private buildWhereClause(filters?: Record<string, any>) {
    if (!filters) return {};

    const where: any = {};

    if (filters.username) {
      where.username = { contains: filters.username };
    }

    if (filters.email) {
      where.email = { contains: filters.email };
    }

    if (filters.status) {
      where.status = filters.status;
    }

    return where;
  }
}
```

---

## å…­ã€è®¤è¯å’Œæˆæƒæµç¨‹

### ç™»å½•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥   â”‚
â”‚ ç”¨æˆ·åå¯†ç   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/auth/login
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éªŒè¯ç”¨æˆ·åå’Œå¯†ç            â”‚
â”‚  æ£€æŸ¥è´¦æˆ·çŠ¶æ€               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ éªŒè¯å¤±è´¥ â†’ è¿”å› 401
       â”‚
       â”‚ éªŒè¯æˆåŠŸ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢ç”¨æˆ·è§’è‰²å’Œæƒé™         â”‚
â”‚  ç”Ÿæˆ JWT Token             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å› Token å’Œç”¨æˆ·ä¿¡æ¯      â”‚
â”‚  å‰ç«¯å­˜å‚¨ Token             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä»£ç **ï¼š

```typescript
// auth.service.ts
import { Injectable } from "@nestjs/common";
import { JwtService } from "@nestjs/jwt";
import { PrismaService } from "@nestjs/prisma";
import * as bcrypt from "bcrypt";

@Injectable()
export class AuthService {
  constructor(
    private prisma: PrismaService,
    private jwtService: JwtService,
  ) {}

  async login(username: string, password: string) {
    // æŸ¥è¯¢ç”¨æˆ·
    const user = await this.prisma.user.findUniqueOrThrow({
      where: { username },
      include: {
        userRoles: {
          include: {
            role: {
              include: {
                rolePermissions: {
                  include: {
                    permission: true,
                  },
                },
              },
            },
          },
        },
      },
    });

    // éªŒè¯å¯†ç 
    const isPasswordValid = await bcrypt.compare(password, user.passwordHash);
    if (!isPasswordValid) {
      throw new UnauthorizedException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }

    // æ£€æŸ¥è´¦æˆ·çŠ¶æ€
    if (user.status !== "ACTIVE") {
      throw new UnauthorizedException("è´¦æˆ·å·²è¢«ç¦ç”¨");
    }

    // æå–æƒé™
    const permissions = user.userRoles.flatMap((ur) =>
      ur.role.rolePermissions.map((rp) => rp.permission.name),
    );

    // ç”Ÿæˆ Token
    const token = this.jwtService.sign({
      id: user.id,
      username: user.username,
      permissions,
    });

    // è®°å½•ç™»å½•æ—¥å¿—
    await this.prisma.loginLog.create({
      data: {
        userId: user.id,
        loginStatus: "SUCCESS",
        loginIp: "192.168.1.1", // ä»è¯·æ±‚ä¸­è·å–
      },
    });

    return {
      token,
      user: {
        id: user.id,
        username: user.username,
        email: user.email,
        realName: user.realName,
        avatarUrl: user.avatarUrl,
        permissions,
      },
    };
  }
}
```

### æƒé™æ£€æŸ¥æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ API
    â†“
JWT å®ˆå«éªŒè¯ Token
    â†“ Token æœ‰æ•ˆ
æå–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
    â†“
æƒé™å®ˆå«æ£€æŸ¥
    â†“
â”œâ”€ æœ‰æƒé™ â†’ å…è®¸æ‰§è¡Œ
â””â”€ æ— æƒé™ â†’ è¿”å› 403
```

---

## ä¸ƒã€Docker éƒ¨ç½²

### Docker Compose é…ç½®

**docker-compose.yml**ï¼š

```yaml
version: "3.8"

services:
  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: admin-postgres
    environment:
      POSTGRES_DB: admin_db
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin123
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - admin-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: admin-redis
    ports:
      - "6379:6379"
    networks:
      - admin-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # åç«¯æœåŠ¡
  backend:
    build:
      context: ./nestjs-admin
      dockerfile: Dockerfile
    container_name: admin-backend
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://admin:admin123@postgres:5432/admin_db
      REDIS_URL: redis://redis:6379
      JWT_SECRET: your-secret-key
      JWT_EXPIRATION: 7d
    ports:
      - "3001:3000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - admin-network
    volumes:
      - ./nestjs-admin:/app
      - /app/node_modules
    command: npm run start:dev

  # å‰ç«¯æœåŠ¡
  frontend:
    build:
      context: ./nextjs-admin
      dockerfile: Dockerfile
    container_name: admin-frontend
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:3001/api
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - admin-network
    volumes:
      - ./nextjs-admin:/app
      - /app/node_modules

  # Nginx åå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: admin-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - frontend
      - backend
    networks:
      - admin-network

volumes:
  postgres_data:

networks:
  admin-network:
    driver: bridge
```

**Dockerfile (Nest.js åç«¯)**ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# è¿è¡Œé˜¶æ®µ
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY --from=builder /app/dist ./dist

EXPOSE 3000

CMD ["node", "dist/main.js"]
```

**Dockerfile (Next.js å‰ç«¯)**ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# è¿è¡Œé˜¶æ®µ
FROM node:18-alpine

WORKDIR /app

RUN npm install -g next

COPY package*.json ./
RUN npm ci --only=production

COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public

EXPOSE 3000

CMD ["npm", "start"]
```

**å¯åŠ¨å‘½ä»¤**ï¼š

```bash
docker-compose up -d
```

---

## å…«ã€åŠŸèƒ½å®ç°æ¸…å•

### å¿«é€Ÿå‚è€ƒè¡¨

| åŠŸèƒ½æ¨¡å—     | æ ¸å¿ƒåŠŸèƒ½             | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ |
| ------------ | -------------------- | ------ | -------- |
| **ç”¨æˆ·è®¤è¯** | ç™»å½•ã€ç™»å‡ºã€å¯†ç ä¿®æ”¹ | P0     | 2 å¤©     |
| **ç”¨æˆ·ç®¡ç†** | å¢åˆ æ”¹æŸ¥ã€æ‰¹é‡æ“ä½œ   | P0     | 3 å¤©     |
| **è§’è‰²æƒé™** | RBACã€æƒé™æ£€æŸ¥       | P0     | 4 å¤©     |
| **èœå•ç®¡ç†** | åŠ¨æ€èœå•ã€æƒé™æ§åˆ¶   | P1     | 2 å¤©     |
| **éƒ¨é—¨ç®¡ç†** | éƒ¨é—¨æ ‘ã€æˆå‘˜ç®¡ç†     | P1     | 2 å¤©     |
| **æ“ä½œæ—¥å¿—** | è®°å½•ã€æŸ¥è¯¢ã€å¯¼å‡º     | P1     | 3 å¤©     |
| **æ•°æ®å­—å…¸** | å­—å…¸ç®¡ç†ã€ç¼“å­˜       | P2     | 2 å¤©     |
| **ç³»ç»Ÿé…ç½®** | å‚æ•°ç®¡ç†ã€çƒ­æ›´æ–°     | P2     | 1 å¤©     |
| **æ–‡ä»¶ç®¡ç†** | ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤     | P2     | 3 å¤©     |
| **ä»ªè¡¨æ¿**   | æ•°æ®ç»Ÿè®¡ã€å›¾è¡¨å±•ç¤º   | P3     | 2 å¤©     |

---

## ä¹ã€å¼€å‘æœ€ä½³å®è·µ

### 1. API è®¾è®¡è§„èŒƒ

**RESTful è§„èŒƒ**ï¼š

```
GET    /api/users              # åˆ—è¡¨
POST   /api/users              # åˆ›å»º
GET    /api/users/:id          # è¯¦æƒ…
PATCH  /api/users/:id          # æ›´æ–°
DELETE /api/users/:id          # åˆ é™¤

# æ‰¹é‡æ“ä½œ
POST   /api/users/batch-delete # æ‰¹é‡åˆ é™¤
```

**å“åº”æ ¼å¼**ï¼š

```typescript
// æˆåŠŸå“åº”
{
  code: 0,
  message: "æ“ä½œæˆåŠŸ",
  data: {
    id: 1,
    username: "admin",
    ...
  }
}

// é”™è¯¯å“åº”
{
  code: -1,
  message: "ç”¨æˆ·ä¸å­˜åœ¨",
  data: null
}
```

---

### 2. é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€å¼‚å¸¸è¿‡æ»¤å™¨
@Catch()
export class AllExceptionsFilter implements ExceptionFilter {
  catch(exception: unknown, host: ExecutionContext) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();

    let status = HttpStatus.INTERNAL_SERVER_ERROR;
    let message = "Internal Server Error";

    if (exception instanceof HttpException) {
      status = exception.getStatus();
      message = exception.getResponse()["message"];
    } else if (exception instanceof PrismaClientKnownRequestError) {
      // Prisma é”™è¯¯å¤„ç†
      status = HttpStatus.BAD_REQUEST;
      message = "æ•°æ®åº“æ“ä½œå¤±è´¥";
    }

    response.status(status).json({
      code: -1,
      message,
      data: null,
    });
  }
}
```

---

### 3. æ€§èƒ½ä¼˜åŒ–

**æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**ï¼š

```typescript
// âŒ N+1 æŸ¥è¯¢é—®é¢˜
const users = await User.find();
for (const user of users) {
  const roles = await Role.find({ userId: user.id }); // æŸ¥è¯¢ N æ¬¡
}

// âœ… ä½¿ç”¨ include å…³è”æŸ¥è¯¢
const users = await prisma.user.findMany({
  include: {
    userRoles: {
      include: {
        role: true,
      },
    },
  },
});
```

**ç¼“å­˜ç­–ç•¥**ï¼š

```typescript
@Injectable()
export class CacheService {
  constructor(private redis: RedisService) {}

  async getWithCache(key: string, fetchFn: () => Promise<any>) {
    // å…ˆä»ç¼“å­˜å–
    const cached = await this.redis.get(key);
    if (cached) {
      return JSON.parse(cached);
    }

    // ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œä»æ•°æ®åº“å–
    const data = await fetchFn();

    // å­˜å…¥ç¼“å­˜ï¼Œ30 åˆ†é’Ÿè¿‡æœŸ
    await this.redis.set(key, JSON.stringify(data), 30 * 60);

    return data;
  }
}
```

---

### 4. å®‰å…¨æœ€ä½³å®è·µ

**å¯†ç å®‰å…¨**ï¼š

```typescript
// ä½¿ç”¨ bcrypt åŠ å¯†
const passwordHash = await bcrypt.hash(password, 10);

// éªŒè¯
const isValid = await bcrypt.compare(password, passwordHash);
```

**SQL æ³¨å…¥é˜²æŠ¤**ï¼š

```typescript
// âŒ å±é™©
const users = await prisma.$queryRaw`
  SELECT * FROM users WHERE username = ${username}
`;

// âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
const users = await prisma.user.findMany({
  where: { username },
});
```

**CORS é…ç½®**ï¼š

```typescript
app.enableCors({
  origin: process.env.CLIENT_URL,
  credentials: true,
  methods: ["GET", "POST", "PUT", "DELETE", "PATCH"],
});
```

---

## åã€å¿«é€Ÿå¼€å§‹æŒ‡å—

### é¡¹ç›®åˆå§‹åŒ–

**1. å…‹éš†æˆ–åˆ›å»ºé¡¹ç›®**ï¼š

```bash
# åç«¯
nest new nestjs-admin
cd nestjs-admin

# å‰ç«¯
npx create-next-app@latest nextjs-admin --typescript --tailwind
cd nextjs-admin
```

**2. å®‰è£…ä¾èµ–**ï¼š

åç«¯ï¼š

```bash
npm install @nestjs/jwt @nestjs/passport passport passport-jwt
npm install @prisma/client prisma
npm install bcrypt
npm install redis @nestjs/cache-manager cache-manager
npm install class-validator class-transformer
```

å‰ç«¯ï¼š

```bash
npm install axios zustand
npm install antd @ant-design/icons
npm install shadcn-ui
npm install recharts nivo
npm install daisyui
```

**3. åˆå§‹åŒ–æ•°æ®åº“**ï¼š

```bash
# Prisma åˆå§‹åŒ–
npx prisma init

# é…ç½® DATABASE_URL åœ¨ .env

# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npx prisma generate

# æ‰§è¡Œè¿ç§»
npx prisma migrate dev --name init
```

**4. å¯åŠ¨å¼€å‘æœåŠ¡**ï¼š

```bash
# åç«¯
npm run start:dev

# å‰ç«¯
npm run dev
```

---

## åä¸€ã€æ€»ç»“å’Œå»ºè®®

### å…³é”®è¦ç‚¹

1. **æƒé™ç³»ç»Ÿæ˜¯åŸºç¡€** - RBAC æ¨¡å‹ç®€å•é«˜æ•ˆï¼Œä¼˜äº ABAC
2. **å®¡è®¡æ—¥å¿—å¾ˆé‡è¦** - ä½¿ç”¨æ‹¦æˆªå™¨è‡ªåŠ¨è®°å½•ï¼Œé¿å…é—æ¼
3. **åˆ†å±‚æ¶æ„æ˜“ç»´æŠ¤** - Controller â†’ Service â†’ Repository æ¸…æ™°èŒè´£
4. **ç¼“å­˜æå‡æ€§èƒ½** - å­—å…¸ã€é…ç½®ç­‰é¢‘ç¹è¯»å–çš„æ•°æ®åº”ç¼“å­˜
5. **æ–‡æ¡£åŒ–å¾ˆå…³é”®** - API æ–‡æ¡£ã€æ•°æ®å­—å…¸ã€æƒé™åˆ—è¡¨è¦è¯¦ç»†

### å¸¸è§é™·é˜±

âŒ **æƒé™æ£€æŸ¥ä¸å®Œæ•´** - åªåœ¨å‰ç«¯æ£€æŸ¥ï¼Œåç«¯ä¹Ÿè¦æ£€æŸ¥  
âŒ **æ—¥å¿—è®°å½•ä¸åŠæ—¶** - åº”è¯¥ç”¨æ‹¦æˆªå™¨è‡ªåŠ¨è®°å½•ï¼Œä¸è¦æ‰‹åŠ¨  
âŒ **å¯†ç å­˜å‚¨ä¸å®‰å…¨** - å¿…é¡»ç”¨ bcrypt ç­‰åŠ å¯†ç®—æ³•  
âŒ **æ²¡æœ‰äº‹åŠ¡ç®¡ç†** - å¤šæ­¥æ“ä½œè¦ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§  
âŒ **ç¼ºå°‘æ•°æ®éªŒè¯** - å‰åç«¯éƒ½è¦éªŒè¯è¾“å…¥æ•°æ®

### è¿›é˜¶ä¼˜åŒ–

ğŸ“ˆ **å¤§æ•°æ®é‡ä¼˜åŒ–**ï¼š

- ä½¿ç”¨åˆ†é¡µï¼Œé¿å…ä¸€æ¬¡åŠ è½½æ‰€æœ‰æ•°æ®
- ä½¿ç”¨ç´¢å¼•æå‡æŸ¥è¯¢é€Ÿåº¦
- è€ƒè™‘åˆ†åº“åˆ†è¡¨

ğŸ”’ **å®‰å…¨å¢å¼º**ï¼š

- å®ç°äºŒæ¬¡è®¤è¯ï¼ˆ2FAï¼‰
- ä½¿ç”¨ OAuth2.0 ç¤¾äº¤ç™»å½•
- å®ç°æ“ä½œç éªŒè¯ï¼ˆé«˜é£é™©æ“ä½œï¼‰

âš¡ **æ€§èƒ½å¢å¼º**ï¼š

- ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº
- å®ç°æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†å¼‚æ­¥ä»»åŠ¡
- ä½¿ç”¨æœç´¢å¼•æ“ï¼ˆElasticsearchï¼‰ä¼˜åŒ–æŸ¥è¯¢

ğŸ“Š **æ•°æ®åˆ†æ**ï¼š

- æ¥å…¥æ•°æ®åŸ‹ç‚¹ç³»ç»Ÿ
- ä½¿ç”¨ BI å·¥å…·åšæ•°æ®åˆ†æ
- å»ºç«‹æŠ¥è¡¨ç³»ç»Ÿ

---

## é™„å½•ï¼šé¡¹ç›®æ¸…å•

### éƒ¨ç½²æ¸…å•

- [ ] æœåŠ¡å™¨é€‰å‹å’Œè´­ä¹°
- [ ] åŸŸåæ³¨å†Œå’Œå¤‡æ¡ˆ
- [ ] SSL è¯ä¹¦é…ç½®
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥
- [ ] æ—¥å¿—æ”¶é›†å’Œåˆ†æ
- [ ] ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•
- [ ] ç¾éš¾æ¢å¤è®¡åˆ’

### æ–‡æ¡£æ¸…å•

- [ ] API æ–‡æ¡£ï¼ˆSwagger/OpenAPIï¼‰
- [ ] æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [ ] éƒ¨ç½²è¿ç»´æ–‡æ¡£
- [ ] ç”¨æˆ·æ‰‹å†Œ
- [ ] æƒé™é…ç½®æŒ‡å—

### æµ‹è¯•æ¸…å•

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å®‰å…¨æµ‹è¯•
- [ ] ç”¨æˆ·éªŒæ”¶æµ‹è¯•

---

è¿™ä»½æ–‡æ¡£æä¾›äº†ä»é›¶å¼€å§‹æ­å»ºä¼ä¸šçº§ç®¡ç†åå°çš„å®Œæ•´æŒ‡å—ã€‚æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå¯ä»¥é€æ­¥å®ç°å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªé«˜æ•ˆã€å®‰å…¨ã€æ˜“ç»´æŠ¤çš„ç³»ç»Ÿã€‚
