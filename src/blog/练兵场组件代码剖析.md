---
title: "ç»ƒå…µåœºç»„ä»¶ä»£ç å‰–æ"
pubDate: 2026-01-28T01:09:37.838Z
description: "æ·±åº¦å‰–æåœ¨çº¿ä»£ç ç¼–è¾‘å™¨ç»„ä»¶ï¼Œä»æ¶æ„è®¾è®¡ã€ç»„ä»¶é€šä¿¡ã€React Hooks åˆ° Monaco Editor é›†æˆï¼Œå®Œæ•´è®²è§£ç°ä»£ React ç»„ä»¶å¼€å‘"
author: "æµ·å·"
image:
  url: ""
  alt: ""
tags: ["React", "ç»„ä»¶è®¾è®¡", "å¹³å°"]
---

## å‰è¨€

è¿™æ˜¯ä¸€ä¸ª**åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ç»„ä»¶**ï¼ˆç®€ç§°"ç»ƒå…µåœº"ï¼‰ï¼Œå¯ä»¥å®æ—¶ç¼–è¾‘ HTMLã€CSSã€JavaScriptï¼Œå¹¶åœ¨å³ä¾§é¢„è§ˆç»“æœã€‚è¿™ä¸ªé¡¹ç›®æ¶‰åŠï¼š

- **æ¶æ„è®¾è®¡**ï¼šå¦‚ä½•ç»„ç»‡å¤æ‚çš„ React ç»„ä»¶
- **çŠ¶æ€ç®¡ç†**ï¼šå¤šä¸ª Editor å®ä¾‹çš„çŠ¶æ€åŒæ­¥
- **Hook è®¾è®¡**ï¼šå°†é€»è¾‘åˆ†ç¦»æˆå¯å¤ç”¨çš„ Hook
- **ç¬¬ä¸‰æ–¹åº“é›†æˆ**ï¼šMonaco Editor é›†æˆ
- **é€šä¿¡æœºåˆ¶**ï¼šiframe ä¸ä¸»çª—å£çš„é€šä¿¡

æœ¬æ–‡é€å±‚å‰–æè¿™ä¸ªç»„ä»¶ï¼Œè®©ä½ æŒæ¡**ç”Ÿäº§çº§åˆ«çš„ React ç»„ä»¶å¼€å‘**ã€‚

---

## ä¸€ã€æ•´ä½“æ¶æ„

### é¡¹ç›®ç»“æ„

```
CodeEditor/
â”œâ”€â”€ index.tsx              # ä¸»ç»„ä»¶å…¥å£
â”œâ”€â”€ types.ts               # ç±»å‹å®šä¹‰
â”œâ”€â”€ EditorPanel.tsx        # å·¦ä¾§ç¼–è¾‘å™¨é¢æ¿
â”œâ”€â”€ PreviewPanel.tsx       # å³ä¾§é¢„è§ˆé¢æ¿
â”œâ”€â”€ ConsolePanel.tsx       # æ§åˆ¶å°è¾“å‡ºé¢æ¿
â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useCodeEditor.ts       # ç¼–è¾‘å™¨åˆå§‹åŒ–
â”‚   â”œâ”€â”€ usePreviewUpdate.ts    # é¢„è§ˆæ›´æ–°é€»è¾‘
â”‚   â”œâ”€â”€ useConsoleOutput.ts    # æ§åˆ¶å°è¾“å‡º
â”‚   â”œâ”€â”€ useEditorActions.ts    # ç¼–è¾‘å™¨æ“ä½œ
â”‚   â”œâ”€â”€ useTabAndTheme.ts      # æ ‡ç­¾é¡µå’Œä¸»é¢˜
â”‚   â””â”€â”€ hooks/
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
    â””â”€â”€ editorUtils.ts         # ç¼–è¾‘å™¨é»˜è®¤ä»£ç 
```

### æ•°æ®æµå‘

```
CodeEditor (ä¸»ç»„ä»¶)
  â”œâ”€ State: activeTab, theme
  â”œâ”€ Refs: editorsRef, containerRefs, previewIframeRef, consoleOutputRef
  â”‚
  â”œâ”€ EditorPanel (å·¦ä¾§ç¼–è¾‘å™¨)
  â”‚  â”œâ”€ æ˜¾ç¤º HTML/CSS/JS ç¼–è¾‘å™¨
  â”‚  â”œâ”€ å“åº”æ ‡ç­¾é¡µåˆ‡æ¢
  â”‚  â””â”€ ä¸»é¢˜åˆ‡æ¢
  â”‚
  â””â”€ PreviewPanel (å³ä¾§é¢„è§ˆ)
     â”œâ”€ é¢„è§ˆ iframe
     â””â”€ ConsolePanel (æ§åˆ¶å°)
        â””â”€ æ˜¾ç¤º console.log è¾“å‡º
```

**å…³é”®ç‰¹ç‚¹**ï¼š

1. **å•ä¸€æ•°æ®æº**ï¼šä¸»ç»„ä»¶ç®¡ç† stateï¼Œé€šè¿‡ ref å…±äº« editor å®ä¾‹
2. **Hook åˆ†ç¦»**ï¼šæ¯ä¸ª Hook è´Ÿè´£ä¸€ä¸ªåŠŸèƒ½åŸŸ
3. **Ref é©±åŠ¨**ï¼šä½¿ç”¨ ref å­˜å‚¨éœ€è¦è·¨ç»„ä»¶è®¿é—®çš„å¯å˜å¯¹è±¡
4. **iframe éš”ç¦»**ï¼šé¢„è§ˆå†…å®¹åœ¨ç‹¬ç«‹çš„ iframe ä¸­è¿è¡Œ

---

## äºŒã€ä¸»ç»„ä»¶å‰–æï¼ˆindex.tsxï¼‰

### æ ¸å¿ƒç»“æ„

```typescript
const CodeEditor: React.FC<CodeEditorProps> = ({ storagePrefix = '' }) => {
  // 1. çŠ¶æ€ç®¡ç†
  const [activeTab, setActiveTab] = useState<TabType>('html');
  const [theme, setTheme] = useState('vs-dark');

  // 2. Ref ç®¡ç†ï¼ˆè·¨ç»„ä»¶å…±äº«çš„å¯å˜å¯¹è±¡ï¼‰
  const previewIframeRef = useRef<HTMLIFrameElement | null>(null);
  const consoleOutputRef = useRef<HTMLDivElement | null>(null);

  // 3. å„ä¸ªåŠŸèƒ½ Hook
  const { editorsRef, containerRefs } = useCodeEditor({ ... });
  const { updatePreview } = usePreviewUpdate({ ... });
  const { handleConsoleClear } = useConsoleOutput({ ... });
  const { handleClearAll, handleDownload } = useEditorActions({ ... });
  const { handleTabChange, handleThemeChange } = useTabAndTheme({ ... });

  // 4. äº‹ä»¶å¤„ç†
  const handleTabChange = (tab: TabType) => { ... };
  const handleThemeChange = (newTheme: string) => { ... };
  const handleRefresh = () => { ... };

  // 5. æ¸²æŸ“
  return (
    <div className="flex flex-row gap-1 h-full">
      <EditorPanel ... />
      <div className="flex flex-col gap-1 flex-1">
        <PreviewPanel ... />
        <ConsolePanel ... />
      </div>
    </div>
  );
};
```

### å…³é”®æ¦‚å¿µè§£è¯»

#### State vs Ref çš„é€‰æ‹©

```typescript
// âœ… ç”¨ Stateï¼šéœ€è¦è§¦å‘é‡æ–°æ¸²æŸ“
const [activeTab, setActiveTab] = useState<TabType>("html");
const [theme, setTheme] = useState("vs-dark");
// å½“è¿™äº›å€¼æ”¹å˜æ—¶ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“

// âœ… ç”¨ Refï¼šéœ€è¦å­˜å‚¨ä½†ä¸è§¦å‘æ¸²æŸ“
const previewIframeRef = useRef<HTMLIFrameElement | null>(null);
const consoleOutputRef = useRef<HTMLDivElement | null>(null);
// è¿™äº›å¯¹è±¡æœ¬èº«ä¸å˜ï¼Œåªæ˜¯å…¶å†…å®¹æ”¹å˜ï¼Œæ— éœ€é‡æ–°æ¸²æŸ“
```

#### ä¸ºä»€ä¹ˆç”¨ Ref æ¥å­˜å‚¨ editor å®ä¾‹ï¼Ÿ

```typescript
const { editorsRef, containerRefs } = useCodeEditor({ ... });

// editorsRef ä¸­å­˜å‚¨çš„æ˜¯ Monaco Editor å®ä¾‹ï¼š
// {
//   htmlEditor: IStandaloneCodeEditor,
//   cssEditor: IStandaloneCodeEditor,
//   jsEditor: IStandaloneCodeEditor
// }

// åŸå› ï¼š
// 1. Editor å®ä¾‹æ˜¯å¤æ‚å¯¹è±¡ï¼Œä¸é€‚åˆç”¨ State ç®¡ç†
// 2. å½“ä»£ç å†…å®¹æ”¹å˜æ—¶ï¼Œåªéœ€æ›´æ–° previewï¼Œä¸éœ€è¦é‡æ–°æ¸²æŸ“
// 3. å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«è¿™äº›å®ä¾‹
```

#### åŒ…è£…çŠ¶æ€æ›´æ–°å‡½æ•°çš„ç›®çš„

```typescript
// ä½¿ç”¨è‡ªå®šä¹‰ Hook è¿”å›çš„å‡½æ•°
const { handleTabChange: computeTabChange } = useTabAndTheme({ editorsRef });

// åœ¨ä¸»ç»„ä»¶ä¸­å†åŒ…è£…ä¸€æ¬¡
const handleTabChange = (tab: TabType) => {
  setActiveTab(tab); // æ›´æ–° UI State
  computeTabChange(tab); // æ‰§è¡Œ Hook ä¸­çš„é€»è¾‘
};

// ä¸ºä»€ä¹ˆï¼Ÿ
// âœ… Hook å¯èƒ½éœ€è¦è®¿é—®æŸäº›çŠ¶æ€æˆ– ref
// âœ… ä¸»ç»„ä»¶è´Ÿè´£ UI çŠ¶æ€ï¼ŒHook è´Ÿè´£ç¼–è¾‘å™¨é€»è¾‘
// âœ… åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§
```

---

## ä¸‰ã€Hook è®¾è®¡æ·±åº¦è®²è§£

### 1. useCodeEditor - ç¼–è¾‘å™¨åˆå§‹åŒ–

```typescript
export const useCodeEditor = ({
  storagePrefix,
  theme,
}: UseCodeEditorConfig) => {
  // âœ… å­˜å‚¨ç¼–è¾‘å™¨å®ä¾‹ï¼ˆRefï¼Œä¸è§¦å‘æ¸²æŸ“ï¼‰
  const editorsRef = useRef<EditorInstances>({
    htmlEditor: null,
    cssEditor: null,
    jsEditor: null,
  });

  // âœ… å­˜å‚¨å®¹å™¨å¼•ç”¨ï¼ˆDOM æŒ‚è½½ç‚¹ï¼‰
  const containerRefs = useRef<ContainerRefs>({
    html: null,
    css: null,
    js: null,
  });

  // âœ… åˆå§‹åŒ–ç¼–è¾‘å™¨
  useEffect(() => {
    // 1. æ£€æŸ¥å®¹å™¨æ˜¯å¦å·²æŒ‚è½½
    if (
      !containerRefs.current.html ||
      !containerRefs.current.css ||
      !containerRefs.current.js
    ) {
      return;
    }

    // 2. ä» localStorage æ¢å¤ä»£ç æˆ–ä½¿ç”¨é»˜è®¤ä»£ç 
    const htmlStorageKey = `${storagePrefix}htmlCode`;
    const htmlEditor = monaco.editor.create(containerRefs.current.html, {
      value: localStorage.getItem(htmlStorageKey) || defaultHTML,
      language: "html",
      theme,
      fontSize: 13,
      lineNumbers: "on",
      automaticLayout: true, // âœ… é‡è¦ï¼šå®¹å™¨å¤§å°æ”¹å˜æ—¶è‡ªåŠ¨è°ƒæ•´
      minimap: { enabled: false },
      formatOnPaste: true,
      formatOnType: true,
    });

    editorsRef.current = { htmlEditor, cssEditor, jsEditor };

    // 3. æ¸…ç†ï¼šé”€æ¯ç¼–è¾‘å™¨ï¼Œé‡Šæ”¾èµ„æº
    return () => {
      htmlEditor.dispose();
      cssEditor.dispose();
      jsEditor.dispose();
    };
  }, []); // âœ… åªåœ¨æŒ‚è½½æ—¶åˆå§‹åŒ–ä¸€æ¬¡

  return { editorsRef, containerRefs };
};
```

**å…³é”®ç‚¹**ï¼š

1. **Ref åœ¨ useEffect å¤–åˆå§‹åŒ–**ï¼šç¡®ä¿ ref åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¸€ç›´æœ‰æ•ˆ
2. **ä¾èµ–æ•°ç»„ä¸ºç©º**ï¼šç¼–è¾‘å™¨åªåˆå§‹åŒ–ä¸€æ¬¡
3. **cleanup å‡½æ•°**ï¼šè°ƒç”¨ `dispose()` é‡Šæ”¾ Monaco Editor çš„èµ„æº
4. **localStorage æŒä¹…åŒ–**ï¼šä»£ç è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤

### 2. usePreviewUpdate - é¢„è§ˆæ›´æ–°é€»è¾‘

```typescript
export const usePreviewUpdate = ({ editorsRef, previewIframeRef, ... }) => {
  // âœ… ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°ï¼Œé˜²æ­¢ä¸å¿…è¦çš„é—­åŒ…é‡å»º
  const updatePreview = useCallback(() => {
    const { htmlEditor, cssEditor, jsEditor } = editorsRef.current || {};
    if (!htmlEditor || !cssEditor || !jsEditor || !previewIframeRef.current) {
      return;
    }

    // 1. è·å–ç¼–è¾‘å™¨çš„ä»£ç 
    const html = htmlEditor.getValue();
    const css = cssEditor.getValue();
    const js = jsEditor.getValue();

    // 2. ä¿å­˜åˆ° localStorage
    localStorage.setItem(htmlStorageKey, html);
    localStorage.setItem(cssStorageKey, css);
    localStorage.setItem(jsStorageKey, js);

    // 3. æ„é€  HTML æ–‡æ¡£
    const iframeContent = `<!DOCTYPE html>
<html>
  <head>
    <style>
      ${css}
    </style>
  </head>
  <body>
    ${html}
    <script>
      // âœ… å…³é”®ï¼šæ‹¦æˆª console è¾“å‡º
      console.log = function(...args) {
        window.parent.postMessage({
          type: 'console',
          method: 'log',
          message: args.join(' ')
        }, '*');
      };

      ${js}
    </script>
  </body>
</html>`;

    // 4. å†™å…¥ iframe
    const iframeDoc = previewIframeRef.current.contentDocument;
    iframeDoc.open();
    iframeDoc.write(iframeContent);
    iframeDoc.close();
  }, [editorsRef, previewIframeRef, storagePrefix]);

  return { updatePreview };
};
```

**å…³é”®ç‚¹**ï¼š

1. **getValue()** - è·å–ç¼–è¾‘å™¨å½“å‰çš„ä»£ç å†…å®¹
2. **iframe éš”ç¦»** - ç”¨æˆ·çš„ä»£ç è¿è¡Œåœ¨ç‹¬ç«‹çš„ iframe ä¸­ï¼Œä¸æ±¡æŸ“ä¸»åº”ç”¨
3. **console æ‹¦æˆª** - é€šè¿‡ `postMessage` å°† console è¾“å‡ºä¼ å›ä¸»çª—å£
4. **localStorage æŒä¹…åŒ–** - æ¯æ¬¡æ›´æ–°éƒ½ä¿å­˜ä»£ç 

### 3. ä»£ç æ‰§è¡Œå’Œé¢„è§ˆçš„å®Œæ•´åŸç†

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œç†è§£å®ƒéœ€è¦æŒæ¡å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š

**ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆå®Œæ•´çš„ HTML æ–‡æ¡£**

```javascript
const iframeContent = `<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { background: #f5f5f5; padding: 20px; }
      ${css}  <!-- ç”¨æˆ·ç¼–å†™çš„ CSS æ³¨å…¥åˆ°è¿™é‡Œ -->
    </style>
  </head>
  <body>
    ${html}  <!-- ç”¨æˆ·ç¼–å†™çš„ HTML æ³¨å…¥åˆ°è¿™é‡Œ -->
    <script>
      // ... console æ‹¦æˆªä»£ç  ...
      ${js}  <!-- ç”¨æˆ·ç¼–å†™çš„ JavaScript æ³¨å…¥åˆ°è¿™é‡Œ -->
    </script>
  </body>
</html>`;
```

**ä¸ºä»€ä¹ˆè¦è¿™æ ·æ„é€ ï¼Ÿ**

1. **å­—ç¬¦ä¸²æ¨¡æ¿æ‹¼æ¥** - å°†ç”¨æˆ·ä»£ç ä½œä¸ºå­—ç¬¦ä¸²æ’å…¥åˆ° HTML æ¨¡æ¿ä¸­
2. **å®Œæ•´çš„ HTML ç»“æ„** - åŒ…å« DOCTYPEã€headã€body ç­‰æ ‡å‡†ç»“æ„
3. **CSS åœ¨å¤´éƒ¨** - ç¡®ä¿æ ·å¼åœ¨ HTML åŠ è½½å‰åº”ç”¨
4. **JS åœ¨åº•éƒ¨** - ç¡®ä¿ DOM åŠ è½½å®Œåå†æ‰§è¡Œ

**ç¬¬äºŒæ­¥ï¼šå°† HTML æ–‡æ¡£å†™å…¥ iframe**

```javascript
const iframeDoc = previewIframeRef.current.contentDocument;
iframeDoc.open(); // æ‰“å¼€æ–‡æ¡£å†™å…¥æµ
iframeDoc.write(iframeContent); // å†™å…¥å®Œæ•´çš„ HTML
iframeDoc.close(); // å…³é—­æ–‡æ¡£å†™å…¥æµ
```

è¿™æ®µä»£ç çš„ä½œç”¨ï¼š

| æ–¹æ³•              | ä½œç”¨                             | ä¸ºä»€ä¹ˆéœ€è¦                     |
| ----------------- | -------------------------------- | ------------------------------ |
| `contentDocument` | è·å– iframe å†…éƒ¨çš„ Document å¯¹è±¡ | è®¿é—® iframe çš„ DOM             |
| `open()`          | æ‰“å¼€æ–‡æ¡£å†™å…¥æµ                   | å‡†å¤‡æ¥æ”¶æ–°å†…å®¹                 |
| `write()`         | å‘æ–‡æ¡£å†™å…¥ HTML å†…å®¹             | å°†æ„é€ å¥½çš„ HTML æ³¨å…¥è¿›å»       |
| `close()`         | å…³é—­å†™å…¥æµå¹¶è§¦å‘æ¸²æŸ“             | å®Œæˆæ³¨å…¥ï¼Œæµè§ˆå™¨å¼€å§‹è§£æå’Œæ¸²æŸ“ |

**ç¬¬ä¸‰æ­¥ï¼šæµè§ˆå™¨è‡ªåŠ¨æ‰§è¡Œ**

```
write() è°ƒç”¨å®Œæˆ
       â†“
æµè§ˆå™¨è§£æ HTMLï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰
       â†“
åŠ è½½ CSS æ ·å¼ï¼ˆåœ¨ <style> ä¸­ï¼‰
       â†“
æ¸²æŸ“ HTML å†…å®¹åˆ° DOM
       â†“
æ‰§è¡Œ <script> ä¸­çš„ JavaScript
       â†“
ç”¨æˆ·çœ‹åˆ°æœ€ç»ˆç»“æœ
```

**å®Œæ•´çš„æ‰§è¡Œæµç¨‹ç¤ºä¾‹**

å‡è®¾ç”¨æˆ·ç¼–å†™äº†ï¼š

```html
<!-- HTML ç¼–è¾‘å™¨ä¸­ -->
<h1>è®¡æ•°å™¨</h1>
<button id="btn">ç‚¹å‡»</button>
<div id="result">è®¡æ•°ï¼š0</div>
```

```css
/* CSS ç¼–è¾‘å™¨ä¸­ */
button {
  padding: 10px 20px;
  background: blue;
  color: white;
}
```

```javascript
// JavaScript ç¼–è¾‘å™¨ä¸­
let count = 0;
document.getElementById("btn").addEventListener("click", () => {
  count++;
  document.getElementById("result").textContent = `è®¡æ•°ï¼š${count}`;
  console.log("è®¡æ•°å¢åŠ :", count);
});
```

**å®Œæ•´æµç¨‹**ï¼š

```
ç”¨æˆ·ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®
    â†“
è°ƒç”¨ updatePreview()
    â†“
è·å–ä¸‰ä¸ªç¼–è¾‘å™¨çš„ä»£ç ï¼ˆgetValueï¼‰
    â†“
ç”Ÿæˆå®Œæ•´çš„ HTML æ–‡æ¡£ï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰
    â†“
é€šè¿‡ iframeDoc.write() æ³¨å…¥åˆ° iframe
    â†“
æµè§ˆå™¨è‡ªåŠ¨è§£æå’Œæ‰§è¡Œ
    â†“
- CSS åº”ç”¨æ ·å¼
- HTML æ¸²æŸ“æˆå¯è§çš„å…ƒç´ 
- JavaScript æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
    â†“
ç”¨æˆ·å¯ä»¥ä¸é¡µé¢äº¤äº’ï¼ˆç‚¹å‡»æŒ‰é’®ï¼‰
    â†“
ç‚¹å‡»æŒ‰é’®è§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°
    â†“
console.log è¢«æ‹¦æˆªå¹¶è½¬å‘åˆ°ä¸»çª—å£
    â†“
ä¸»çª—å£çš„ useConsoleOutput Hook æ¥æ”¶æ¶ˆæ¯å¹¶æ˜¾ç¤º
```

**å…³é”®çš„éš”ç¦»æœºåˆ¶**

ä¸ºä»€ä¹ˆç”¨æˆ·çš„ä»£ç ä¸ä¼šæ±¡æŸ“ä¸»åº”ç”¨ï¼Ÿ

```javascript
// âŒ å¦‚æœç›´æ¥æ‰§è¡Œ
eval(userCode); // å±é™©ï¼ç”¨æˆ·ä»£ç å¯ä»¥è®¿é—® windowã€DOM ç­‰

// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ iframe
// iframe åˆ›å»ºäº†ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å…¨å±€ä½œç”¨åŸŸ
// ç”¨æˆ·çš„ window å¯¹è±¡æŒ‡å‘ iframe çš„ window
// ç”¨æˆ·çš„ document å¯¹è±¡æŒ‡å‘ iframe çš„ document
// ä¸»åº”ç”¨çš„ windowã€document å®Œå…¨éš”ç¦»
```

**iframe çš„å†…éƒ¨å’Œå¤–éƒ¨é€šä¿¡**

```javascript
// iframe å†…éƒ¨ï¼ˆè¢«æ³¨å…¥çš„ä»£ç ä¸­ï¼‰
window.parent; // æŒ‡å‘ä¸»çª—å£
window.self; // æŒ‡å‘ iframe æœ¬èº«

// ä¸»çª—å£ä¸­
previewIframeRef.current.contentWindow; // æŒ‡å‘ iframe çš„ window

// é€šè¿‡ postMessage å¯ä»¥å®‰å…¨åœ°é€šä¿¡
// iframe å†…ï¼š
window.parent.postMessage({ type: "console", message: "Hello" }, "*");

// ä¸»çª—å£ä¸­ï¼š
window.addEventListener("message", (event) => {
  console.log(event.data); // { type: 'console', message: 'Hello' }
});
```

**localStorage çš„æŒä¹…åŒ–åŸç†**

```javascript
// æ¯æ¬¡ç‚¹å‡»"åˆ·æ–°"æ—¶éƒ½ä¼šæ‰§è¡Œ
localStorage.setItem(`${storagePrefix}htmlCode`, html);
localStorage.setItem(`${storagePrefix}cssCode`, css);
localStorage.setItem(`${storagePrefix}jsCode`, js);

// ä¸‹æ¬¡é¡µé¢åŠ è½½æ—¶
const htmlEditor = monaco.editor.create(container, {
  value: localStorage.getItem(`${storagePrefix}htmlCode`) || defaultHTML,
  // ...
});
```

è¿™å®ç°äº†ï¼š

- **è‡ªåŠ¨ä¿å­˜**ï¼šæ¯æ¬¡æ›´æ–°é¢„è§ˆéƒ½ä¼šä¿å­˜
- **è‡ªåŠ¨æ¢å¤**ï¼šé¡µé¢åˆ·æ–°åä»£ç ä¸ä¸¢å¤±
- **å¤šå®ä¾‹æ”¯æŒ**ï¼šä¸åŒçš„ storagePrefix å¯ä»¥å­˜å‚¨ä¸åŒçš„ä»£ç 

### 4. iframe å’Œ postMessage æœºåˆ¶

```typescript
// iframe å†…éƒ¨ï¼ˆè¢«æ³¨å…¥çš„ HTMLï¼‰
console.log = function (...args) {
  window.parent.postMessage(
    {
      type: "console",
      method: "log",
      message: args.join(" "),
    },
    "*",
  ); // '*' è¡¨ç¤ºæ¥æ”¶æ¥è‡ªä»»ä½•æºçš„æ¶ˆæ¯
};

// ============= åˆ†ç•Œçº¿ =============

// ä¸»çª—å£ä¸­ï¼ˆuseConsoleOutput Hookï¼‰
useEffect(() => {
  const handleMessage = (event: MessageEvent) => {
    if (event.data.type === "console") {
      // æ¥æ”¶æ¥è‡ª iframe çš„ console è¾“å‡º
      const { method, message } = event.data;
      appendConsoleOutput(method, message);
    }
  };

  window.addEventListener("message", handleMessage);
  return () => window.removeEventListener("message", handleMessage);
}, []);
```

### 5. useConsoleOutput - æ§åˆ¶å°è¾“å‡º

```typescript
export const useConsoleOutput = ({ consoleOutputRef, previewIframeRef }) => {
  useEffect(() => {
    // âœ… ç›‘å¬æ¥è‡ª iframe çš„æ¶ˆæ¯
    const handleMessage = (event: MessageEvent) => {
      if (event.data.type !== "console") return;

      const { method, message } = event.data;
      const output = consoleOutputRef.current;

      if (!output) return;

      // åˆ›å»ºè¾“å‡ºå…ƒç´ 
      const line = document.createElement("div");
      line.className = `console-${method}`; // error/log/warn ç­‰ä¸åŒæ ·å¼
      line.textContent = `[${method}] ${message}`;

      output.appendChild(line);
      output.scrollTop = output.scrollHeight; // âœ… è‡ªåŠ¨æ»šåˆ°æœ€åº•éƒ¨
    };

    window.addEventListener("message", handleMessage);
    return () => window.removeEventListener("message", handleMessage);
  }, []);

  // âœ… æ¸…ç©ºæ§åˆ¶å°è¾“å‡º
  const handleConsoleClear = () => {
    if (consoleOutputRef.current) {
      consoleOutputRef.current.innerHTML = "";
    }
    // é€šçŸ¥ iframe æ¸…ç©º console
    previewIframeRef.current?.contentWindow?.postMessage(
      { type: "console-clear" },
      "*",
    );
  };

  return { handleConsoleClear };
};
```

**å…³é”®ç‚¹**ï¼š

1. **åŒå‘é€šä¿¡**ï¼šä¸»çª—å£ â†’ iframe å’Œ iframe â†’ ä¸»çª—å£
2. **DOM æ“ä½œ**ï¼šåŠ¨æ€åˆ›å»ºæ§åˆ¶å°è¾“å‡ºå…ƒç´ 
3. **è‡ªåŠ¨æ»šåŠ¨**ï¼šæ–°è¾“å‡ºæ—¶è‡ªåŠ¨æ»šåˆ°åº•éƒ¨

### 6. useEditorActions - ç¼–è¾‘å™¨æ“ä½œ

```typescript
export const useEditorActions = ({
  editorsRef,
  storagePrefix,
  updatePreview,
}) => {
  // âœ… æ¸…ç©ºæ‰€æœ‰ä»£ç 
  const handleClearAll = () => {
    if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä»£ç å—ï¼Ÿ")) {
      const { htmlEditor, cssEditor, jsEditor } = editorsRef.current || {};
      htmlEditor?.setValue("");
      cssEditor?.setValue("");
      jsEditor?.setValue("");
      updatePreview();
    }
  };

  // âœ… ä¸‹è½½ä»£ç ä¸º HTML æ–‡ä»¶
  const handleDownload = () => {
    const { htmlEditor, cssEditor, jsEditor } = editorsRef.current || {};

    const html = htmlEditor?.getValue() || "";
    const css = cssEditor?.getValue() || "";
    const js = jsEditor?.getValue() || "";

    const content = `<!DOCTYPE html>
<html>
  <head>
    <style>${css}</style>
  </head>
  <body>
    ${html}
    <script>${js}<\/script>
  </body>
</html>`;

    // âœ… åˆ›å»º Blob å¹¶ä¸‹è½½
    const blob = new Blob([content], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "code.html";
    a.click();
    URL.revokeObjectURL(url); // âœ… æ¸…ç†èµ„æº
  };

  return { handleClearAll, handleDownload };
};
```

**å…³é”®ç‚¹**ï¼š

1. **setValue()** - è®¾ç½®ç¼–è¾‘å™¨çš„ä»£ç å†…å®¹
2. **Blob åˆ›å»º** - ç”ŸæˆäºŒè¿›åˆ¶æ•°æ®ç”¨äºä¸‹è½½
3. **èµ„æºæ¸…ç†** - `revokeObjectURL()` é‡Šæ”¾å†…å­˜ä¸­çš„ URL

---

## å››ã€å…³é”® React æ¦‚å¿µ

### æ¦‚å¿µ 1ï¼šuseRef vs useState

```typescript
// âŒ ä¸å¥½ï¼šç”¨ State å­˜å‚¨ç¼–è¾‘å™¨å®ä¾‹
const [editors, setEditors] = useState<EditorInstances | null>(null);
// æ¯æ¬¡ editors å˜åŒ–éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œè€Œä¸”ç¼–è¾‘å™¨å®ä¾‹æœ¬èº«ä¸éœ€è¦é‡æ–°æ¸²æŸ“

// âœ… å¥½ï¼šç”¨ Ref å­˜å‚¨
const editorsRef = useRef<EditorInstances | null>(null);
// ç›´æ¥å­˜å‚¨å¯å˜å¯¹è±¡ï¼Œæ— éœ€æ¸²æŸ“

// è®°ä½è¿™ä¸ªåŒºåˆ«ï¼š
// State = éœ€è¦è§¦å‘æ¸²æŸ“çš„æ•°æ®
// Ref = éœ€è¦ä¿å­˜ä½†ä¸è§¦å‘æ¸²æŸ“çš„æ•°æ®
```

### æ¦‚å¿µ 2ï¼šuseCallback çš„ä½œç”¨

```typescript
// âŒ ä¸ç”¨ useCallback
const updatePreview = () => {
  // æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ªå‡½æ•°éƒ½ä¼šé‡æ–°åˆ›å»º
};

// å½“ä¼ é€’ç»™å­ç»„ä»¶æ—¶ï¼š
<PreviewPanel onChange={updatePreview} />
// å­ç»„ä»¶çš„ onChange ä¾èµ–é¡¹æ€»æ˜¯æ–°çš„ï¼Œå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

// âœ… ç”¨ useCallback
const updatePreview = useCallback(() => {
  // ...
}, [editorsRef, previewIframeRef]); // åªåœ¨ä¾èµ–æ”¹å˜æ—¶é‡æ–°åˆ›å»º

// ä¼˜åŠ¿ï¼š
// 1. é¿å…å­ç»„ä»¶çš„ä¸å¿…è¦æ¸²æŸ“
// 2. ç¨³å®šçš„å‡½æ•°å¼•ç”¨
// 3. ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼ˆç»“åˆ React.memoï¼‰
```

### æ¦‚å¿µ 3ï¼šuseEffect çš„ä¾èµ–æ•°ç»„

```typescript
// âŒ æ²¡æœ‰ä¾èµ–æ•°ç»„ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ
useEffect(() => {
  // è¿™ä¼šå¯¼è‡´æ— é™æ¸²æŸ“å’Œå†…å­˜æ³„æ¼ï¼
  setupListener();
});

// âœ… ç©ºä¾èµ–æ•°ç»„ï¼šåªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
useEffect(() => {
  setupListener(); // ç¼–è¾‘å™¨åˆå§‹åŒ–
  return () => cleanup(); // å¸è½½æ—¶æ¸…ç†
}, []);

// âœ… æœ‰ä¾èµ–é¡¹ï¼šå½“ä¾èµ–æ”¹å˜æ—¶æ‰§è¡Œ
useEffect(() => {
  updateEditorTheme(theme);
}, [theme]); // ä¸»é¢˜æ”¹å˜æ—¶æ›´æ–°ç¼–è¾‘å™¨
```

### æ¦‚å¿µ 4ï¼šRef çš„æ­£ç¡®ä½¿ç”¨

```typescript
// âŒ é”™è¯¯ï¼šåœ¨ if è¯­å¥ä¸­åˆå§‹åŒ– ref
function BadComponent() {
  let ref;
  if (someCondition) {
    ref = useRef(null); // âŒ React Hook è§„åˆ™è¿å
  }
  return <div ref={ref} />;
}

// âœ… æ­£ç¡®ï¼šåœ¨é¡¶å±‚åˆå§‹åŒ– ref
function GoodComponent() {
  const ref = useRef(null); // âœ… æ— æ¡ä»¶
  return <div ref={ref} />;
}

// âœ… ä¸ºä»€ä¹ˆè¦åœ¨ Hook ä¸­è€Œä¸æ˜¯æ™®é€šå‡½æ•°ä¸­ï¼Ÿ
const containerRefs = useRef<ContainerRefs>({ html: null, ... });
// useRef ç¡®ä¿ Ref åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…æŒä¹…å­˜åœ¨
// æ™®é€šå˜é‡æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆå§‹åŒ–
```

### æ¦‚å¿µ 5ï¼šforwardRef æ¨¡å¼

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼ŒEditorPanel å’Œ PreviewPanel éœ€è¦å°† ref ä¼ é€’ç»™å­ç»„ä»¶ï¼š

```typescript
// EditorPanel.tsx
interface EditorPanelProps {
  containerRefs: React.MutableRefObject<ContainerRefs>;
  // ...
}

const EditorPanel: React.FC<EditorPanelProps> = ({ containerRefs, ... }) => {
  return (
    <div>
      {activeTab === 'html' && <div ref={(el) => { if (el) containerRefs.current.html = el; }} />}
      {activeTab === 'css' && <div ref={(el) => { if (el) containerRefs.current.css = el; }} />}
      {activeTab === 'js' && <div ref={(el) => { if (el) containerRefs.current.js = el; }} />}
    </div>
  );
};

// ä¸ºä»€ä¹ˆä¸ç”¨ forwardRefï¼Ÿ
// å› ä¸ºæˆ‘ä»¬ä¼ é€’çš„æ˜¯ containerRefs å¯¹è±¡ï¼Œä¸æ˜¯å•ä¸ª ref
// è¿™æ˜¯ä¸€ç§æ›´çµæ´»çš„æ¨¡å¼
```

---

## äº”ã€æ€§èƒ½ä¼˜åŒ–åˆ†æ

### 1. automaticLayout çš„ä½œç”¨

```typescript
const htmlEditor = monaco.editor.create(containerRefs.current.html, {
  automaticLayout: true, // âœ… å…³é”®ï¼
  // ...
});

// âœ… automaticLayout åšäº†ä»€ä¹ˆï¼Ÿ
// - ç›‘å¬å®¹å™¨å¤§å°æ”¹å˜
// - è‡ªåŠ¨è°ƒæ•´ç¼–è¾‘å™¨å¤§å°
// - æ— éœ€æ‰‹åŠ¨å¤„ç† resize äº‹ä»¶

// âŒ å¦‚æœä¸è®¾ç½®ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†
window.addEventListener("resize", () => {
  htmlEditor.layout();
});
```

### 2. useCallback çš„å¿…è¦æ€§

```typescript
// updatePreview å‡½æ•°è¢«å¤šä¸ªåœ°æ–¹ä½¿ç”¨ï¼š
// 1. æŒ‰é’®ç‚¹å‡»æ—¶åˆ·æ–°
// 2. ä»£ç æ”¹å˜æ—¶è‡ªåŠ¨æ›´æ–°
// 3. æ¸…ç©ºæ—¶è°ƒç”¨

// ä¸ç”¨ useCallback çš„åæœï¼š
// - æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
// - ä¼ ç»™å­ç»„ä»¶æ—¶å¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
// - å¯èƒ½æ— é™é€’å½’ï¼ˆå¦‚æœåœ¨ä¾èµ–é¡¹ä¸­ï¼‰
```

### 3. localStorage çš„ä¼˜åŒ–

```typescript
// ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–ï¼Ÿ
// 1. ç”¨æˆ·ä½“éªŒï¼šåˆ·æ–°é¡µé¢ä»£ç ä¸ä¸¢å¤±
// 2. æ”¯æŒå¤šä¸ªç¼–è¾‘å™¨å®ä¾‹ï¼šç”¨ storagePrefix åŒºåˆ†

const htmlStorageKey = `${storagePrefix}htmlCode`;
localStorage.setItem(htmlStorageKey, html);

// storagePrefix å…è®¸åŒä¸€é¡µé¢æœ‰å¤šä¸ªç¼–è¾‘å™¨ï¼š
// 'playground_1_htmlCode'
// 'playground_2_htmlCode'
// 'blog_post_htmlCode'
```

---

## å…­ã€å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ

### Q1ï¼šä¸ºä»€ä¹ˆç¼–è¾‘å™¨ä»£ç æ”¹å˜æ—¶é¢„è§ˆä¸è‡ªåŠ¨æ›´æ–°ï¼Ÿ

```typescript
// ç›®å‰çš„è®¾è®¡éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®

// å¦‚æœè¦è‡ªåŠ¨æ›´æ–°ï¼Œå¯ä»¥è¿™æ ·åšï¼š
useEffect(() => {
  // ç›‘å¬ç¼–è¾‘å™¨å˜åŒ–
  const htmlDisposable = htmlEditor?.onDidChangeModelContent(() => {
    updatePreview();
  });

  return () => {
    htmlDisposable?.dispose();
  };
}, []);

// âš ï¸ æ³¨æ„ï¼šè¿™å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼ˆé¢‘ç¹æ›´æ–°é¢„è§ˆï¼‰
// è§£å†³ï¼šç”¨é˜²æŠ–
const debouncedUpdate = useCallback(
  debounce(() => updatePreview(), 500),
  [],
);
```

### Q2ï¼šå¦‚ä½•å¤„ç† JavaScript æ‰§è¡Œé”™è¯¯ï¼Ÿ

```typescript
// ç›®å‰çš„å®ç°ä¸­ï¼Œiframe å†…çš„ error äº‹ä»¶è¢«æ‹¦æˆªï¼š
window.addEventListener("error", function (e) {
  window.parent.postMessage(
    {
      type: "console",
      method: "error",
      message: e.message,
      stack: e.stack,
    },
    "*",
  );
});

// è¿™æ ·ç”¨æˆ·å†™çš„ä»£ç å‡ºé”™æ—¶ï¼Œä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
```

### Q3ï¼šå¦‚ä½•é˜²æ­¢ iframe ä¸­çš„æ¶æ„ä»£ç ï¼Ÿ

```typescript
// âœ… iframe sandbox å±æ€§
<iframe
  srcDoc={iframeContent}
  sandbox="allow-scripts allow-same-origin"
  // sandbox é™åˆ¶äº† iframe çš„æƒé™
  // allow-scripts: å…è®¸æ‰§è¡Œè„šæœ¬
  // allow-same-origin: å…è®¸åŒæºè®¿é—®ï¼ˆä¾¿äº postMessageï¼‰
/>

// âš ï¸ ä¸åº”è¯¥å…è®¸ï¼š
// - allow-forms: å¯èƒ½è¢«ç”¨äºé’“é±¼
// - allow-top-navigation: å¯èƒ½æ”¹å˜ä¸»çª—å£çš„ URL
// - allow-pointer-lock: å¯èƒ½è·å¾—è¿‡å¤šæƒé™
```

### Q4ï¼šå†…å­˜æ³„æ¼é£é™©åœ¨å“ªé‡Œï¼Ÿ

```typescript
// âœ… å·²å¤„ç†çš„ï¼š
// 1. useEffect ä¸­æœ‰ cleanupï¼ˆdispose ç¼–è¾‘å™¨ï¼‰
// 2. event listener æœ‰æ¸…ç†
// 3. Blob URL æœ‰ revoke

// âš ï¸ æ½œåœ¨é£é™©ï¼š
// 1. localStorage æ— é™å¢é•¿ï¼ˆä»£ç ä¸æ–­ç´¯ç§¯ï¼‰
// 2. iframe çš„ console è¾“å‡ºæ— é™å¢é•¿
// è§£å†³ï¼šå®šæœŸæ¸…ç†
const MAX_CONSOLE_LINES = 1000;
if (output.children.length > MAX_CONSOLE_LINES) {
  output.removeChild(output.firstChild);
}
```

---

## ä¸ƒã€æ‰©å±•å»ºè®®

### 1. æ·»åŠ ä»£ç æ ¼å¼åŒ–

```typescript
// ä½¿ç”¨ prettier
const formatCode = async () => {
  const prettier = await import("prettier");
  const formatted = prettier.format(code, {
    parser: "babel",
    trailingComma: "es5",
  });
  htmlEditor.setValue(formatted);
};
```

### 2. æ·»åŠ ä»£ç è¡¥å…¨å’Œé”™è¯¯æ£€æŸ¥

```typescript
// Monaco Editor æœ¬èº«æ”¯æŒ
const htmlEditor = monaco.editor.create(container, {
  // å·²å¯ç”¨ï¼š
  formatOnPaste: true,
  formatOnType: true,

  // å¯ä»¥æ·»åŠ ï¼š
  suggestOnTriggerCharacters: true,
  quickSuggestions: { other: true, comments: false, strings: false },
});
```

### 3. æ·»åŠ  URL åˆ†äº«åŠŸèƒ½

```typescript
const handleShare = () => {
  const code = {
    html: htmlEditor.getValue(),
    css: cssEditor.getValue(),
    js: jsEditor.getValue(),
  };

  // æ–¹æ¡ˆ 1ï¼šURL ç¼–ç 
  const encoded = btoa(JSON.stringify(code));
  const url = `${location.origin}?code=${encoded}`;

  // æ–¹æ¡ˆ 2ï¼šServer ç«¯å­˜å‚¨
  const id = await saveCode(code);
  const url = `${location.origin}?id=${id}`;
};
```

### 4. æ·»åŠ æ¨¡æ¿åº“

```typescript
const templates = {
  hello: {
    html: "<h1>Hello World</h1>",
    css: "h1 { color: blue; }",
    js: 'alert("Hello");',
  },
  calculator: {
    /* ... */
  },
};

const loadTemplate = (name: string) => {
  const template = templates[name];
  htmlEditor.setValue(template.html);
  cssEditor.setValue(template.css);
  jsEditor.setValue(template.js);
  updatePreview();
};
```

---

## å…«ã€æ€»ç»“ä¸å­¦ä¹ è·¯å¾„

### æ ¸å¿ƒæ¦‚å¿µæ¸…å•

- âœ… **State vs Ref**ï¼šä½•æ—¶ç”¨å“ªä¸ª
- âœ… **useCallback**ï¼šä¼˜åŒ–å‡½æ•°å¼•ç”¨
- âœ… **useEffect ä¾èµ–**ï¼šé˜²æ­¢æ— é™å¾ªç¯
- âœ… **iframe éš”ç¦»**ï¼šä»£ç å®‰å…¨è¿è¡Œ
- âœ… **postMessage**ï¼šè·¨çª—å£é€šä¿¡
- âœ… **localStorage**ï¼šæ•°æ®æŒä¹…åŒ–
- âœ… **Ref è½¬å‘**ï¼šè·¨ç»„ä»¶ä¼ é€’ ref

### å…³é”®æŠ€æœ¯ç‚¹

| æŠ€æœ¯                  | ç”¨é€”         | ä½ç½®                            |
| --------------------- | ------------ | ------------------------------- |
| **Monaco Editor**     | ä»£ç ç¼–è¾‘     | useCodeEditor                   |
| **iframe**            | ä»£ç éš”ç¦»è¿è¡Œ | PreviewPanel                    |
| **postMessage**       | é€šä¿¡æœºåˆ¶     | ConsolePanel                    |
| **localStorage**      | ä»£ç æŒä¹…åŒ–   | useCodeEditorã€usePreviewUpdate |
| **Ref & useCallback** | æ€§èƒ½ä¼˜åŒ–     | æ•´ä¸ªç»„ä»¶                        |

### å­¦ä¹ å»ºè®®

1. **åˆå­¦è€…**ï¼šç†è§£ Stateã€Refã€useEffect çš„æ¦‚å¿µ
2. **è¿›é˜¶**ï¼šå­¦ä¹ å¦‚ä½•è®¾è®¡ Hook å’Œ Ref çš„å…±äº«
3. **é«˜çº§**ï¼šç ”ç©¶ iframe é€šä¿¡ã€æ€§èƒ½ä¼˜åŒ–ã€é”™è¯¯å¤„ç†

### ç›¸å…³æœ€ä½³å®è·µ

- ğŸ“Œ **Hook è®¾è®¡**ï¼šå•ä¸€èŒè´£ï¼Œæ˜“äºæµ‹è¯•å’Œå¤ç”¨
- ğŸ“Œ **Ref ç®¡ç†**ï¼šå¿…é¡»æ—¶æ‰ç”¨ï¼Œä¸è¦è¿‡åº¦ä½¿ç”¨
- ğŸ“Œ **æ€§èƒ½**ï¼šuseCallback ç”¨äºå›è°ƒï¼ŒuseMemo ç”¨äºè®¡ç®—
- ğŸ“Œ **æ¸…ç†**ï¼šuseEffect å¿…é¡»æœ‰ cleanup å‡½æ•°
- ğŸ“Œ **é€šä¿¡**ï¼šçˆ¶ç»„ä»¶é€šè¿‡ propsï¼Œå…„å¼Ÿé€šè¿‡ ref å’Œå›è°ƒ

---
